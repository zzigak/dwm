(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TabManagementMode=t.ExtensionMessage=t.PopoverType=t.FirefoxKeys=t.NORMAL=t.MINIMIZED=t.FULLSCREEN=t.V3_FLAG=t.TAB_RESTORE_DNS=t.WHERE_TABS_KEY=t.PRESENCE_INACTIVE=t.PRESENCE_ACTIVE=t.TABCACHE_SIZE=t.UNSAVED_ID=t.TASKS_NOTES_RE=t.ABOUT_RE=t.HOSTNAME_RE=t.DATA_URI_RE=t.HTTPS_RE=t.HTTP_RE=t.WORKONA_MANAGED_RE=t.TABCACHE_RE=t.SETUP_RE=t.WEBAPP_EXT_RE=t.WEBAPP_RE=t.SITE_RE=t.WORKONA_COM_RE=t.WORKONA_EMPTY_FAVICON_RE=t.ACTIVE_FORM_RE=t.MARVELOUS_SUSPENDER_TAB_RE=t.GREAT_SUSPENDER_TAB_RE=t.EXAMPLE_TAB_RE=t.EXT_DEFER_RE=t.DEFER_RE=t.REDIRECT_RE=t.NEWTAB_RE=t.ANY_EXT_RE=t.ABOUT_BLANK_URL=t.EXAMPLE_TAB_URL=t.EXTENSION_FEEDBACK_URL=t.TABCACHE_URL=t.EXT_DEFER_URL=t.DEFER_URL=t.FIREFOX_STORE_URL=t.EDGE_STORE_URL=t.CHROME_STORE_URL=t.WORKONA_MANAGED=t.EXT_IS_FIREFOX=t.EXT_IS_EDGE=t.APP_PATH=t.APP_BASE_PATH=t.SITE_URL=t.EDGE_NEWTAB_EXT_ID=t.CHROME_NEWTAB_EXT_ID=t.FIREFOX_EXT_ID=t.EDGE_EXT_ID=t.CHROME_EXT_ID=t.VERSION=void 0,t.VERSION="2.21.7",t.CHROME_EXT_ID="ailcmbgekjpnablpdkmaaccecekgdhlh",t.EDGE_EXT_ID="gdfnelpciiajgjenlapgkdcjpcfpfpob",t.FIREFOX_EXT_ID="firefox-addon@workona.com",t.CHROME_NEWTAB_EXT_ID="mccohdmggonaiebbkliphakblbbfofck",t.EDGE_NEWTAB_EXT_ID="bafackfaecokjkipilfhpebnmjgmkifb",t.SITE_URL="https://workona.com/",t.APP_BASE_PATH=t.SITE_URL,t.APP_PATH=t.APP_BASE_PATH+"0/",t.EXT_IS_EDGE=!1,t.EXT_IS_FIREFOX=!1,t.WORKONA_MANAGED=t.EXT_IS_FIREFOX,t.CHROME_STORE_URL="https://chrome.google.com/webstore/detail/"+t.CHROME_EXT_ID,t.EDGE_STORE_URL="https://microsoftedge.microsoft.com/addons/detail/"+t.EDGE_EXT_ID,t.FIREFOX_STORE_URL="https://addons.mozilla.org/firefox/addon/workona/",t.DEFER_URL="https://workona.com/redirect/",t.EXT_DEFER_URL="chrome-extension://"+t.CHROME_EXT_ID+"/defer.html",t.TABCACHE_URL=t.APP_BASE_PATH+"inactive/",t.EXTENSION_FEEDBACK_URL=t.SITE_URL+"extension-feedback/",t.EXAMPLE_TAB_URL=t.SITE_URL+"example",t.ABOUT_BLANK_URL="about:blank",t.ANY_EXT_RE=/^(chrome-extension:\/\/)/,t.NEWTAB_RE=new RegExp("^(chrome://newtab|chrome-extension://"+t.CHROME_NEWTAB_EXT_ID+"/newtab.html|edge://newtab|extension://"+t.EDGE_NEWTAB_EXT_ID+"/newtab.html|moz-extension://.*|about:home)"),t.REDIRECT_RE=new RegExp("^https://workona.com/redirect/#"),t.DEFER_RE=new RegExp("^https://workona.com/(redirect|suspended)/#"),t.EXT_DEFER_RE=new RegExp("^"+t.EXT_DEFER_URL+"#"),t.EXAMPLE_TAB_RE=new RegExp("^"+t.EXAMPLE_TAB_URL),t.GREAT_SUSPENDER_TAB_RE=new RegExp("^chrome-extension://klbibkeccnjlkjkiokjodocebajanakg/suspended.html#"),t.MARVELOUS_SUSPENDER_TAB_RE=new RegExp("^chrome-extension://noogafoofpebimajpfpamcfhoaifemoa/suspended.html#"),t.ACTIVE_FORM_RE=new RegExp("https?://(?:[^/]+/wp-admin/.*(?:post|edit)|twitter\\.com/compose/tweet|wordpress\\.com/(?:page|post)/[^/?#]+/\\d+)"),t.WORKONA_EMPTY_FAVICON_RE=new RegExp("^https://workona.com/assets/meta/earth@2x\\.png"),t.WORKONA_COM_RE=new RegExp("^https://workona.com"),t.SITE_RE=new RegExp("^"+t.APP_BASE_PATH),t.WEBAPP_RE=new RegExp("^"+t.APP_PATH),t.WEBAPP_EXT_RE=new RegExp("^"+t.APP_BASE_PATH+"(0|w|setup|login|signup|tab-manager/signup)(/|$)"),t.SETUP_RE=new RegExp("^"+t.APP_BASE_PATH+"setup(/|$)"),t.TABCACHE_RE=new RegExp("^"+t.APP_BASE_PATH+"inactive(/|$)"),t.WORKONA_MANAGED_RE=new RegExp("^"+t.APP_BASE_PATH+"(0|inactive|installed|login|signup|tab-manager/signup|setup/organize)(/|$)"),t.HTTP_RE=/^https?:\/\//,t.HTTPS_RE=/^https:\/\//,t.DATA_URI_RE=/^data:/,t.HOSTNAME_RE=/^https?:\/\/((?:[^/?#]+?\.)(?:[^/?#]+?))(?=[/?#]|$)/,t.ABOUT_RE=/^about:/,t.TASKS_NOTES_RE=new RegExp("^"+t.APP_BASE_PATH+"(tasks|notes)(/|$)"),t.UNSAVED_ID="new",t.TABCACHE_SIZE={h:580,w:460},t.PRESENCE_ACTIVE=9e5,t.PRESENCE_INACTIVE=144e5,t.WHERE_TABS_KEY="wkWrTb",t.TAB_RESTORE_DNS="trdns",t.V3_FLAG="v3",t.FULLSCREEN="fullscreen",t.MINIMIZED="minimized",t.NORMAL="normal",function(e){e.SEND_MESSAGE="workona-firefox-send-message",e.PORT_INIT="workona-firefox-port-init",e.PORT_REMOVE="workona-firefox-port-remove",e.PORT_ON_MESSAGE="workona-firefox-port-on-message",e.PORT_ON_DISCONNECT="workona-firefox-port-on-disconnect",e.PORT_POST_MESSAGE="workona-firefox-port-post-message",e.PORT_RESPONSE_MESSAGE="workona-firefox-port-reponse-message",e.PORT_LAST_ERROR="workona-firefox-port-last-error"}(t.FirefoxKeys||(t.FirefoxKeys={})),function(e){e.SAVE="save",e.MOVE="move",e.SEND="send"}(t.PopoverType||(t.PopoverType={})),function(e){e[e.CURRENT_TAB=1]="CURRENT_TAB",e[e.WINS_ALL=5]="WINS_ALL",e[e.UPDATE_TAB=13]="UPDATE_TAB",e[e.FAV_ICON_URL=20]="FAV_ICON_URL",e[e.ENSURE_MANAGER=23]="ENSURE_MANAGER",e[e.CMD_LIST=27]="CMD_LIST",e[e.TAB_CACHE_SETTINGS=32]="TAB_CACHE_SETTINGS",e[e.DISCARD_TABS=36]="DISCARD_TABS",e[e.SYSTEM_MEMORY=38]="SYSTEM_MEMORY",e[e.REMOVE_EXTENSION=42]="REMOVE_EXTENSION",e[e.ASYNCHROME=44]="ASYNCHROME",e[e.BIND_WINDOW=45]="BIND_WINDOW",e[e.BIND_TABS=46]="BIND_TABS",e[e.CREATE_AND_BIND_TABS=47]="CREATE_AND_BIND_TABS",e[e.QUERY_CLIENT=48]="QUERY_CLIENT",e[e.CLIENT_QUERY_RESPONSE=49]="CLIENT_QUERY_RESPONSE",e[e.VERIFY_TAB_CACHE=51]="VERIFY_TAB_CACHE",e[e.BTN_DRAW_ATTENTION=52]="BTN_DRAW_ATTENTION",e[e.SEND_PORT_MESSAGE=53]="SEND_PORT_MESSAGE",e[e.HANDLE_URLS_PERMISSION=54]="HANDLE_URLS_PERMISSION",e[e.EXECUTE_CLICK_ACTION=55]="EXECUTE_CLICK_ACTION",e[e.GET_CLICK_DATA=56]="GET_CLICK_DATA",e[e.UPDATE_VIRTUAL_TABS=57]="UPDATE_VIRTUAL_TABS",e[e.OPEN_IN_WORKONA=58]="OPEN_IN_WORKONA",e[e.SET_ICON=59]="SET_ICON",e[e.ACTIVATE_VIRTUAL_SET=61]="ACTIVATE_VIRTUAL_SET",e[e.UPDATE_NEWTAB_SETTINGS=62]="UPDATE_NEWTAB_SETTINGS",e[e.UNMANAGED_WINDOWS=63]="UNMANAGED_WINDOWS",e[e.IS_CURRENT_WINDOW_MANAGED=64]="IS_CURRENT_WINDOW_MANAGED"}(t.ExtensionMessage||(t.ExtensionMessage={})),function(e){e[e.TAB_CACHE=1]="TAB_CACHE",e[e.SAME_WINDOW=2]="SAME_WINDOW",e[e.NEW_WINDOW=3]="NEW_WINDOW"}(t.TabManagementMode||(t.TabManagementMode={}))},,function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.btabs=t.bwins=void 0;var i=a(n(1)),o=a(n(14)),s=n(0);t.bwins={get:function(e,t){return!0===t&&(t={populate:!0}),o.default("windows.get",e,t)},getCurrent:function(e){return!0===e&&(e={populate:!0}),o.default("windows.getCurrent",e)},getAll:function(e){return!0===e&&(e={populate:!0}),o.default("windows.getAll",r({windowTypes:[s.NORMAL]},e))},create:function(e){return null!=e.left&&e.state?o.default("windows.create",r(r({},e),{state:s.NORMAL})):o.default("windows.create",e)},focus:function(e){return t.bwins.update(e,{focused:!0})},update:function(e,t){return o.default("windows.update",e,t)},remove:function(e){return o.default("windows.remove",e)},onCreated:{addListener:function(e){return chrome.windows.onCreated.addListener(e)}},onFocusChanged:{addListener:function(e){return chrome.windows.onFocusChanged.addListener(e)}},onRemoved:{addListener:function(e){return chrome.windows.onRemoved.addListener(e)}}};var u=["windowId","index","url","active","pinned"],c=["url","active","highlighted","pinned","muted","autoDiscardable"];t.btabs={get:function(e){return o.default("tabs.get",e)},getCurrent:function(){return o.default("tabs.getCurrent")},query:function(e){return o.default("tabs.query",e)},create:function(e){return e&&-1===e.index&&delete e.index,o.default("tabs.create",i.default.pick(e||{},u))},update:function(e,t){return o.default("tabs.update",e,i.default.pick(t,c))},move:function(e,t){return o.default("tabs.move",e,t)},reload:function(e){return o.default("tabs.reload",e)},discard:function(e){return o.default("tabs.discard",e)},remove:function(e){return o.default("tabs.remove",e)},highlight:function(e){return o.default("tabs.highlight",e)},goBack:function(e){return o.default("tabs.goBack",e)},onActivated:{addListener:function(e){return chrome.tabs.onActivated.addListener(e)}},onAttached:{addListener:function(e){return chrome.tabs.onAttached.addListener(e)}},onCreated:{addListener:function(e){return chrome.tabs.onCreated.addListener(e)}},onDetached:{addListener:function(e){return chrome.tabs.onDetached.addListener(e)}},onMoved:{addListener:function(e){return chrome.tabs.onMoved.addListener(e)}},onRemoved:{addListener:function(e){return chrome.tabs.onRemoved.addListener(e)}},onReplaced:{addListener:function(e){return chrome.tabs.onReplaced.addListener(e)}},onUpdated:{addListener:function(e){return chrome.tabs.onUpdated.addListener(e)}}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.cleanWindow=t.cleanTab=t.managerUrl=t.isActivated=t.isIgnored=t.delay=t.sanitizeUrl=t.compact=t.qs=t.parseQs=t.retryCondition=t.equalByKeys=t.isUrlSubset=t.isDomainSubset=t.urlDomain=t.tabDomain=t.urlPath=t.tabPath=t.DAY_ZERO=t.EXT_SESSION_ID=t.EXT_CLIENT_ID=void 0;var u=s(n(1)),c=s(n(20)),l=s(n(12)),d=n(0),f=s(n(13));t.EXT_CLIENT_ID=localStorage.clientId||f.default(),localStorage.clientId=t.EXT_CLIENT_ID,t.EXT_SESSION_ID=f.default(),t.DAY_ZERO=15147936e5;var b=c.default.createHash("superfasthash");t.tabPath=function(e){return e?t.urlPath(e.url||""):null},t.urlPath=function(e){return e.split("#")[0].split("?")[0]},t.tabDomain=function(e){return e?t.urlDomain(e.url||e.pendingUrl||""):null},t.urlDomain=function(e){return l.default.parse(e).host||void 0},t.isDomainSubset=function(e,n){return!(e.length>n.length)&&0===u.default.differenceBy(e,n,t.tabDomain).length},t.isUrlSubset=function(e,n){return!(e.length>n.length)&&0===u.default.differenceBy(e.map((function(e){return e.url})),n.map((function(e){return e.url})),(function(e){return e&&t.sanitizeUrl(e)})).length},t.equalByKeys=function(e,t,n){return n.every((function(n){return e[n]===t[n]}))},t.retryCondition=function(e,t,n){return new Promise((function(r){var a=!1,i=function(){clearTimeout(s),clearInterval(o),a||(a=!0,r())},o=setInterval((function(){e().then((function(e){e&&i()})).catch(console.warn)}),t),s=setTimeout(i,n)}))},t.parseQs=function(e,t){var n={};return(e.split(t?"#":"?")[1]||"").split("&").forEach((function(e){var t=o(e.split("="),2),r=t[0],a=t[1];if(r&&a)try{n[decodeURIComponent(r)]=decodeURIComponent(a)}catch(e){e instanceof URIError||console.warn(e)}})),n},t.qs=function(e,t,n){void 0===t&&(t={});var r=t||{},a=[];if(Object.keys(r).forEach((function(e){var t=r[e];if(null!=t)try{a.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}catch(e){e instanceof URIError||console.warn(e)}})),a.length>0){var i=n?"#":e.includes("?")?"&":"?";return""+e+i+a.join("&")}return e},t.compact=function(e){return null!=e};var h=/\//g,p=/\./g,v=/[~*[\]]/g,w=/[^a-zA-Z0-9_.-]/;t.sanitizeUrl=function(e){var t=o(e.split("#")),n=t[0],r=t.slice(1),a=null;return r&&(a=r.join("#")),a&&w.test(a)&&(n+="#"+a),n.length>128&&(n=n.substr(0,128)+"#"+b.hash(n.substr(128))),n.replace(/^https?:\/\/(www\.)?/g,"").replace(v,"_").replace(h,"|").replace(p,"!")},t.delay=function(e){return a(void 0,void 0,void 0,(function(){return i(this,(function(t){return[2,new Promise((function(t){setTimeout(t,e)}))]}))}))},t.isIgnored=function(e){var t=e.url||e.pendingUrl||"";return e.pinned||d.ABOUT_RE.test(t)},t.isActivated=function(){return!d.EXT_IS_FIREFOX||!!localStorage.activated};var E=/[^a-z0-9]+/g;t.managerUrl=function(e,t,n,r){void 0===r&&(r=!0);var a=r?d.APP_PATH:"/0/";return e?""+a+e.id+(e.title?"/"+e.title.toLowerCase().replace(E,"-"):""):t?""+a+t.replace("temp_",""):n?a+"new":a},t.cleanTab=function(e){return u.default.omit(e,"highlighted","openerTabId","autoDiscardable","incognito","width","height","sessionId")},t.cleanWindow=function(e){return e.tabs?r(r({},e),{tabs:e.tabs.map(t.cleanTab)}):e}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a,i=n(0),o=r(n(15));!function(e){e.WORKONA="wkna",e.GREAT_SUSPENDER="tgs"}(a||(a={}));var s=new(function(){function e(){var e=o.default.get("wkTabCache",{tabManagement:!1});this._prevTabCacheWinId=e.winId||null,this._tabCacheWinId=null,this._prevTabCacheManagerId=e.tabId||null,this._tabCacheManagerId=null,this._tabManagement=!!e.tabManagement,this._mode=e.mode||(e.disabled?i.TabManagementMode.NEW_WINDOW:i.TabManagementMode.TAB_CACHE),this._tabSuspension=!!e.tabSuspension,this._suspender=e.suspender||a.WORKONA,this._maxTabs=parseInt(e.maxTabs,10)||25,this._tabTTL=parseInt(e.tabTTL,10)||-1,this._discardBlacklist=e.discardBlacklist||"",this._preventAudibleDiscard=void 0===e.preventAudibleDiscard||!!e.preventAudibleDiscard}return Object.defineProperty(e.prototype,"maxTabs",{get:function(){return this._tabSuspension?this._maxTabs:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tabTTL",{get:function(){return this._tabSuspension?this._tabTTL:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"discardBlacklist",{get:function(){return this._discardBlacklist},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"preventAudibleDiscard",{get:function(){return this._preventAudibleDiscard},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tabCacheEnabled",{get:function(){return this._mode===i.TabManagementMode.TAB_CACHE},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tabCacheWinId",{get:function(){return this._tabCacheWinId},set:function(e){this._tabCacheWinId=e,this.update({})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tabCacheManagerId",{get:function(){return this._tabCacheManagerId},set:function(e){this._tabCacheManagerId=e,this.update({})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"prevTabCacheWinId",{get:function(){return this._prevTabCacheWinId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"prevTabCacheManagerId",{get:function(){return this._prevTabCacheManagerId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tabManagerOn",{get:function(){return this._tabManagement},enumerable:!1,configurable:!0}),e.prototype.update=function(e){if(e&&(null!=e.tabManagerOn&&(this._tabManagement=!!e.tabManagerOn),null!=e.tabManagementMode?this._mode=e.tabManagementMode:null!=e.tabCacheEnabled&&(this._mode=e.tabCacheEnabled?i.TabManagementMode.TAB_CACHE:i.TabManagementMode.NEW_WINDOW),null!=e.tabSuspensionOn&&(this._tabSuspension=!!e.tabSuspensionOn),null!=e.suspender&&(this._suspender=e.suspender),parseInt(e.maxTabs,10)&&(this._maxTabs=parseInt(e.maxTabs,10)||-1),parseInt(e.tabTTL,10)&&(this._tabTTL=parseInt(e.tabTTL,10)||-1),null!=e.discardBlacklist&&(this._discardBlacklist=e.discardBlacklist||""),null!=e.preventAudibleDiscard&&(this._preventAudibleDiscard=!!e.preventAudibleDiscard)),e){var t={discardBlacklist:this._discardBlacklist,maxTabs:this._maxTabs,mode:this._mode,preventAudibleDiscard:this._preventAudibleDiscard,suspender:this._suspender,tabId:this._tabCacheManagerId,tabManagement:this._tabManagement,tabSuspension:this._tabSuspension,tabTTL:this._tabTTL,winId:this._tabCacheWinId};o.default.set("wkTabCache",t)}return{discardBlacklist:this._discardBlacklist,maxTabs:this._maxTabs,preventAudibleDiscard:this._preventAudibleDiscard,suspender:this._suspender,tabCacheEnabled:this._mode===i.TabManagementMode.TAB_CACHE,tabCacheManagerId:this._tabCacheManagerId,tabCacheWinId:this._tabCacheWinId,tabManagementMode:this._mode,tabManagerOn:this._tabManagement,tabSuspensionOn:this._tabSuspension,tabTTL:this._tabTTL}},e}());t.default=s},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},c=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.removeTab=t.updateTab=t.createTab=t.removeActiveTabIdForWindow=t.updateActiveTab=t.ensureManager=t.getUnmanagedWindows=t.isCurrentWindowManagedByWorkona=t.getReliableCurrentTab=t.getReliableCurrentWindow=t.emitChange=t.getAllProcessedTabs=t.getTab=t.autoDiscardTabs=t.discardableTabs=t.showTabs=t.hideTabs=t.getLastClosedWindow=t.getAllTabs=t.isWorkonaWindow=t.getWindowBindings=t.bindWindow=t.bindTab=t.tempId=t.getter=t.addTabListener=void 0;var d,f=l(n(1)),b=l(n(12)),h=n(0),p=n(3),v=n(2),w=l(n(4)),E=n(6),_=["url","favIconUrl","title","index","active","windowId","pinned"],g={},T={},m={},I={},y=[],A=null,R={};t.addTabListener=function(e){y.push(e)},t.getter={get tabSet(){return g},get tabSrcWins(){return T},get windowIds(){return m},get windowBindings(){return R},get lastClosedWindow(){return A},set lastClosedWindow(e){A=e},get lastFocusedWinId(){return d},set lastFocusedWinId(e){d=e}};var S=0;t.tempId=function(){return S+=1,"temp_"+(Math.floor((Date.now()-p.DAY_ZERO)/1e3)+S)},t.bindTab=function(e,n){void 0===n&&(n=null),"tabcache"!==n&&t.updateTab(e,{gId:n,prevWorkspace:null})},t.bindWindow=function(e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1),n?(Object.keys(R).forEach((function(e){R[e]===n&&(!r&&Object.values(g).some((function(t){return t.windowId===parseInt(e,10)}))||delete R[e])})),R[e]=n):delete R[e],t.emitChange()},t.getWindowBindings=function(){return R},t.isWorkonaWindow=function(e){return!h.WORKONA_MANAGED||!!I[e]},t.getAllTabs=function(){return a(void 0,void 0,void 0,(function(){var e,n,r;return i(this,(function(a){switch(a.label){case 0:return[4,v.btabs.query({windowType:"normal"})];case 1:return e=a.sent(),m={},h.WORKONA_MANAGED?(I={},w.default.tabCacheWinId&&(I[w.default.tabCacheWinId]=!0),n={},e.forEach((function(e){m[e.windowId]=!0,h.WORKONA_MANAGED_RE.exec(e.url||e.pendingUrl||"")&&(I[e.windowId]=!0),e.pinned||h.NEWTAB_RE.exec(e.url||e.pendingUrl||"")||(n[e.windowId]=!0)})),r=0,Object.keys(m).forEach((function(e){I[e]||(n[e]&&(r+=1),delete m[e])})),[2,[e.filter((function(e){return I[e.windowId]})).map((function(e){return t.updateTab(e.id,e,{silent:!0,checkEquals:!0})})),r]]):(e.forEach((function(e){m[e.windowId]=!0})),[2,[e.map((function(e){return t.updateTab(e.id,e,{silent:!0,checkEquals:!0})})),0]])}}))}))},t.getLastClosedWindow=function(){return A},t.hideTabs=function(e,n,r){return a(void 0,void 0,void 0,(function(){var n,a,o,s,u,c,l,d,f;return i(this,(function(i){switch(i.label){case 0:return n=Array.isArray(r)?r:[r],0===(a=n.map((function(e){return g[e]})).filter((function(e){return e}))).length?[2,[]]:a.every((function(e){var t=e.url||e.pendingUrl||"";return h.NEWTAB_RE.test(t)||t===h.ABOUT_BLANK_URL}))?[4,v.btabs.remove(n)]:[3,2];case 1:return i.sent(),[2,n];case 2:return e.disabled?[4,v.bwins.create({tabId:n[0]})]:[3,5];case 3:return o=i.sent(),[4,v.btabs.move(n.slice(1),{windowId:o.id,index:-1})];case 4:return i.sent(),[2,n];case 5:return[4,e.hasWindow()];case 6:return i.sent()?[3,11]:[4,v.bwins.create({state:h.MINIMIZED,url:h.TABCACHE_URL})];case 7:return o=i.sent(),w.default.tabCacheWinId=o.id,(s=null===(l=null===(c=o.tabs)||void 0===c?void 0:c[0])||void 0===l?void 0:l.id)?[4,v.btabs.update(s,{pinned:!0})]:[3,9];case 8:i.sent(),i.label=9;case 9:return e.closeIfEmpty.cancel(),E.preventTabCacheClaim(),[4,e.initWindow(o.id,null===(f=null===(d=o.tabs)||void 0===d?void 0:d[0])||void 0===f?void 0:f.id)];case 10:i.sent(),i.label=11;case 11:return a.forEach((function(e){T[e.id]=e.windowId,e.gId||(u=u||t.tempId(),t.bindTab(e.id,u))})),[2,e.cache(a)]}}))}))},t.showTabs=function(e,t,n){return a(void 0,void 0,void 0,(function(){var r,a,o,u,c,l,d;return i(this,(function(i){switch(i.label){case 0:if(0===(r=(Array.isArray(t)?t:[t]).map((function(e){return g[e]})).filter((function(e){return e}))).length)return[2];i.label=1;case 1:i.trys.push([1,6,7,8]),a=s(r),o=a.next(),i.label=2;case 2:return o.done?[3,5]:(u=o.value,delete T[u.id],[4,v.btabs.move(u.id,{windowId:n||u.srcWindowId||u.windowId,index:-1})]);case 3:i.sent(),i.label=4;case 4:return o=a.next(),[3,2];case 5:return[3,8];case 6:return c=i.sent(),l={error:c},[3,8];case 7:try{o&&!o.done&&(d=a.return)&&d.call(a)}finally{if(l)throw l.error}return[7];case 8:return[4,e.closeIfEmpty()];case 9:return i.sent(),[2]}}))}))},t.discardableTabs=function(e){var t=w.default.discardBlacklist,n=w.default.preventAudibleDiscard,r=t.split("\n").map((function(e){return e.replace(/^https?:\/\/(?:www\.)?/,"")})).filter((function(e){return e.trim()}));return e.filter((function(e){if(e.discarded||e.deferred||e.ignored||e.active||"complete"!==e.status)return!1;if(n&&e.audible)return!1;var t=e.url||e.pendingUrl||"",a=t.replace(/^https?:\/\/(?:www\.)?/,"");return h.HTTP_RE.test(t)&&!h.ACTIVE_FORM_RE.test(t)&&!h.TABCACHE_RE.test(t)&&!r.some((function(t){var n;return a.startsWith(t)||(null===(n=e.domain)||void 0===n?void 0:n.endsWith(t))}))}))},t.autoDiscardTabs=f.default.debounce((function(){return a(void 0,void 0,void 0,(function(){var e,n,r,a,o,s,l,d,f;return i(this,(function(i){switch(i.label){case 0:if(chrome.history.search({startTime:Date.now()-2592e6,text:'"'+h.DEFER_URL+'"'},(function(e){e.forEach((function(e){e.url&&chrome.history.deleteUrl({url:e.url})}))})),chrome.history.search({startTime:Date.now()-2592e6,text:'"'+h.TABCACHE_URL+'"'},(function(e){e.forEach((function(e){e.url&&chrome.history.deleteUrl({url:e.url})}))})),h.EXT_IS_FIREFOX&&(e=chrome.extension.getURL("defer.html"),chrome.history.search({startTime:Date.now()-2592e6,text:'"'+e+'"'},(function(e){e.forEach((function(e){e.url&&chrome.history.deleteUrl({url:e.url})}))}))),n=w.default.maxTabs,(r=w.default.tabTTL)<=0&&n<=0)return[2];i.label=1;case 1:return i.trys.push([1,7,,8]),[4,t.getAllTabs()];case 2:return a=u.apply(void 0,[i.sent(),1]),o=a[0],r>0?(s=Date.now()-Math.max(6e4,r),l=t.discardableTabs(o).filter((function(e){return(e.activatedAt||0)<s})),[4,Promise.all(l.map((function(e){return v.btabs.discard(e.id)})))]):[3,4];case 3:return i.sent(),[3,6];case 4:return(d=c(o)).sort((function(e,t){var n=(t.activatedAt||0)-(e.activatedAt||0);return 0===n?t.id-e.id:n})),[4,Promise.all(t.discardableTabs(d.slice(n)).map((function(e){return v.btabs.discard(e.id)})))];case 5:i.sent(),i.label=6;case 6:return[3,8];case 7:return f=i.sent(),console.log(f),[3,8];case 8:return[2]}}))}))}),2e3),t.getTab=function(e){return g[e]},t.getAllProcessedTabs=function(e){return a(void 0,void 0,void 0,(function(){var n,a,s,c;return i(this,(function(i){switch(i.label){case 0:return(c=e)?[3,2]:[4,t.getAllTabs()];case 1:c=i.sent(),i.label=2;case 2:return n=u.apply(void 0,[c,2]),a=n[0],s=n[1],[2,[a.map((function(e){var t=e.gId,n=(e.groupId,e.prevWorkspace,e.srcWindowId),a=o(e,["gId","groupId","prevWorkspace","srcWindowId"]);return r(r({},a),n?{gId:t||null,groupId:t||null,windowId:n}:{gId:t||null,groupId:t||null})})),s]]}}))}))},t.emitChange=f.default.debounce((function(){return a(void 0,void 0,void 0,(function(){var e,n,r,a,o,s;return i(this,(function(i){switch(i.label){case 0:return[4,t.getAllTabs()];case 1:return e=u.apply(void 0,[i.sent(),2]),n=e[0],r=e[1],[4,t.getAllProcessedTabs([n,r])];case 2:return a=u.apply(void 0,[i.sent(),1]),o=a[0],s=E.getProcessedVirtualWindows(),y.forEach((function(e){return e(o,s,r)})),E.savePendingVirtualTabs(n,R),[2]}}))}))}),250),t.getReliableCurrentWindow=function(){return a(void 0,void 0,void 0,(function(){var e;return i(this,(function(n){e=t.getter.lastFocusedWinId;try{if(void 0!==e)return[2,v.bwins.get(e,!0)];throw new Error}catch(e){return[2,v.bwins.getCurrent(!0)]}return[2]}))}))},t.getReliableCurrentTab=function(){return a(void 0,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,t.getReliableCurrentWindow()];case 1:return e=n.sent(),[2,(e.tabs||[]).find((function(e){return e.active}))||v.btabs.getCurrent()]}}))}))},t.isCurrentWindowManagedByWorkona=function(){return a(void 0,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,t.getReliableCurrentWindow()];case 1:return e=n.sent(),[2,[t.isWorkonaWindow(e.id),e.id]]}}))}))},t.getUnmanagedWindows=function(){return a(void 0,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,v.bwins.getAll(!0)];case 1:return[2,e.sent().filter((function(e){return!t.isWorkonaWindow(e.id)})).map((function(e){var t="",n=(e.tabs||[]).filter((function(e){return!e.pinned&&!h.NEWTAB_RE.exec(e.url||"")})),r=n.find((function(e){return e.url}));return r&&r.url?(t=(b.default.parse(r.url).host||"").replace(/^www\./,""),n.length>1&&(t+=" + "+(n.length-1)),{id:e.id,title:t}):null})).filter((function(e){return e}))]}}))}))},t.ensureManager=function(e){var n=e.windowId,r=e.focus,o=e.query,s=void 0===o?{}:o,u=e.useExtendedDef,c=e.verifyWindow,l=e.workspaceId;return a(void 0,void 0,void 0,(function(){var e,a,o,d,b,E,_,g,T,m,I,y,A,R;return i(this,(function(i){switch(i.label){case 0:return a=[],void 0!==(e=n)?[3,2]:[4,t.getReliableCurrentWindow()];case 1:o=i.sent(),e=o.id,a=o.tabs||[],i.label=2;case 2:if(c&&!t.isWorkonaWindow(e))throw new Error("Cannot create a manager in a window not controlled by Workona.");return(null==a?void 0:a.length)?(b=a,[3,5]):[3,3];case 3:return[4,v.btabs.query({windowId:e})];case 4:b=i.sent(),i.label=5;case 5:return d=b,E=w.default.tabManagerOn,_=p.managerUrl(l?{id:l}:void 0),(g=d.find((function(e){return(u?h.WEBAPP_EXT_RE:h.WEBAPP_RE).test(e.url||e.pendingUrl||"")}))||d.find((function(e){return h.NEWTAB_RE.test(e.url||e.pendingUrl||"")})))?(T=h.NEWTAB_RE.test(g.url||g.pendingUrl||""),m=g.url||g.pendingUrl||"",I=void 0,(!f.default.isEmpty(s)||T||l)&&(y=T||l?_:m,I=f.default.isEmpty(s)?y:p.qs(y,s)),[4,v.btabs.update(g.id,{active:r,pinned:!!E||void 0,url:I})]):[3,7];case 6:return i.sent(),[2];case 7:return l||(A=t.getWindowBindings()[e])&&"tabcache"!==A&&(s.wsId=A,_+=A.replace("temp_","")),[4,v.btabs.create({active:!1,index:0,pinned:E,url:p.qs(_,s),windowId:e})];case 8:return R=i.sent(),r?[4,v.btabs.update(R.id,{active:!0})]:[3,10];case 9:i.sent(),i.label=10;case 10:return[2]}}))}))};var W={};t.updateActiveTab=function(e,n){var r=W[n];r&&g[r]&&t.updateTab(r,{active:!1,activatedAt:Date.now()}),W[n]=e,t.updateTab(e,{active:!0})},t.removeActiveTabIdForWindow=function(e){delete W[e]},t.createTab=function(e){return m[e.windowId]=!0,t.updateTab(e.id,r({activatedAt:Date.now(),createdAt:Date.now()},e))},t.updateTab=function(e,n,a){void 0===n&&(n={}),void 0===a&&(a={});var i=a.silent,o=a.checkEquals,s=g[e]||{},u=r(r(r({deferred:!1,hidden:!1,truncated:!1},s),n),{id:e,url:n.url||n.pendingUrl||s.url||s.pendingUrl||""});u.ignored=p.isIgnored(u),n.active&&!s.active&&(u.activatedAt=Date.now(),u.discarded&&v.btabs.reload(u.id).catch(console.warn));var c=T[e];if(c&&m[c]&&c!==u.windowId?(u.srcWindowId=c,u.hidden=!0):(delete u.srcWindowId,u.hidden=!1),u.url&&u.url!==s.url){var l;if(u.extensionDeferred=h.EXT_DEFER_RE.test(u.url),u.deferred=u.extensionDeferred||h.DEFER_RE.test(u.url),u.deferred)(l=p.parseQs(u.url,!0)).url&&(u.url=l.url);if(h.GREAT_SUSPENDER_TAB_RE.test(u.url)||h.MARVELOUS_SUSPENDER_TAB_RE.test(u.url))(l=u.url.split("uri=").slice(1).join("uri="))&&(u.url=l);u.url.length>2048?(u.url=u.url.substr(0,2048),u.truncated=!0):u.truncated=!1;var d=b.default.parse(u.url.split(/[#?]/)[0]),f=d.host,w=d.path;f&&(u.domain=f),w&&(u.path=w)}u.deferred&&((l=p.parseQs(u.url,!0)).favIconUrl&&(u.favIconUrl=l.favIconUrl));h.EXAMPLE_TAB_RE.test(u.url)&&((l=p.parseQs(u.url)).icon&&(u.favIconUrl=l.icon));var E=s.favIconUrl,I=u.favIconUrl;if(I&&h.WORKONA_EMPTY_FAVICON_RE.test(I)?u.favIconUrl="":u.domain===s.domain&&E&&h.HTTP_RE.test(E)&&I&&!h.HTTP_RE.test(I)&&(u.favIconUrl=E),u.pinned&&u.gId)delete u.gId,delete u.prevWorkspace;else if(s.pinned&&!u.pinned){var y=R[u.windowId];y&&"tabcache"!==y&&(u.gId=y,delete u.prevWorkspace)}else!R[u.windowId]&&s.domain&&u.domain!==s.domain&&(u.gId?(u.prevWorkspace={domain:s.domain,id:u.gId},delete u.gId):u.prevWorkspace&&u.prevWorkspace.domain===u.domain&&(u.gId=u.prevWorkspace.id,delete u.prevWorkspace));return o&&p.equalByKeys(s,u,_)||(u.updatedAt=Date.now()),g[u.id]=u,i||t.emitChange(),u},t.removeTab=function(e){delete g[e],delete T[e],t.emitChange()}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleSoloWindow=t.updateLockHandleSoloWindow=t.checkForExtReload=t.removeVirtualTabs=t.claimVirtualGroup=t.unlockCloseLock=t.lockVirtualGroups=t.restoreVirtualPinned=t.activateVirtualSet=t.savePendingVirtualTabsThrottled=t.savePendingVirtualTabs=t.preventTabCacheClaim=t.getProcessedVirtualWindows=void 0;var l=c(n(1)),d=n(0),f=c(n(15)),b=n(3),h=n(2),p=c(n(4)),v=n(16),w=n(5),E=function(e){var t=e.groupId,n=void 0===t?null:t,a=o(e,["groupId"]);return n?r(r({},a),{gId:n}):e},_=function(e){var t=e.groupId,n=void 0===t?null:t,a=o(e,["groupId"]);return n?r(r({},a),{gId:n,tabs:e.tabs.map(E)}):r(r({},e),{tabs:e.tabs.map(E)})},g=function(e){var t=e.gId,n=o(e,["gId"]);return r(r({},n),{gId:t,groupId:t,tabs:e.tabs.map((function(e){return r(r({},e),{gId:e.gId||null,groupId:e.gId||null})}))})},T=["id","title","url","gId","truncated","extensionDeferred","deferred"],m=["title","url","truncated"],I=f.default.get("virtual",[]).map(_),y=f.default.get("pnd",[]),A=0,R=!0,S=!1,W=null;t.getProcessedVirtualWindows=function(){return I.map(g)},t.preventTabCacheClaim=function(){return R=!1};var O=function(e,t){return r(r({},l.default.pick(e,T)),{favIconUrl:d.HTTP_RE.test(e.favIconUrl||"")?e.favIconUrl:void 0,index:e.index-t,url:e.url||e.pendingUrl})},C=function(e){return 0!==e.length&&!(A>Date.now())};t.savePendingVirtualTabs=function(e,n,r){C(e)&&(S?W=[e,n,r]:t.savePendingVirtualTabsThrottled(e,n,r))};var P=function(e,t){return e.filter((function(e){return e.windowId===t&&e.pinned})).length};t.savePendingVirtualTabsThrottled=l.default.throttle((function(e,t,n){if(C(e)&&!v.isShutDown())if(S)W||(W=[e,t,n]);else{var a=s(l.default.partition(e,(function(e){return e.pinned})),2),i=a[0],o=a[1];M(i);var c=o.filter((function(e){return!(e.ignored||!n&&!e.gId)})),d=l.default.groupBy(c,"windowId"),b=u(I.map((function(e){return r(r({},e),{unclaimed:!0})})));Object.entries(d).forEach((function(n){var r=s(n,2),a=r[0],i=r[1];i.sort((function(e,t){return e.index-t.index}));var o=t[a]||"temp_win"+a,u=P(e,a),c=b.findIndex((function(e){return e.gId===o}));c>-1&&b.splice(c,1),b.push({gId:o,tabs:i.map((function(e){return O(e,u)})),windowId:parseInt(a,10)})})),f.default.set("virtual",b)}}),3e3),t.activateVirtualSet=function(e,t,n){return a(void 0,void 0,void 0,(function(){var r,a,o;return i(this,(function(i){switch(i.label){case 0:return[4,w.getAllTabs()];case 1:return r=s.apply(void 0,[i.sent(),1]),a=r[0],o=P(a,e),I.push({gId:t,tabs:u(n).sort((function(e,t){return(e.index||0)-(t.index||0)})).map((function(e){return O(e,o)})),windowId:e}),w.emitChange(),[2]}}))}))};var M=function(e){var t=e.filter((function(e){var t=e.url||e.pendingUrl||"";return!d.WEBAPP_EXT_RE.test(t)&&!d.TABCACHE_RE.test(t)&&!d.ABOUT_RE.test(t)}));t.sort((function(e,t){return e.windowId===t.windowId?e.index-t.index:e.windowId-t.windowId}));var n=t.map((function(e){return r(r({},l.default.pick(e,m)),{favIconUrl:d.HTTP_RE.test(e.favIconUrl||"")?e.favIconUrl:void 0,url:e.url||e.pendingUrl})}));f.default.set("pnd",l.default.uniqBy(n,(function(e){return e.url})))},N=!1;t.restoreVirtualPinned=function(e){return a(void 0,void 0,void 0,(function(){var t,n,r;return i(this,(function(a){switch(a.label){case 0:return!e||N?[2]:(N=!0,[4,h.btabs.query({pinned:!0})]);case 1:return t=a.sent(),n=t.filter((function(e){return e.pinned&&!d.WEBAPP_EXT_RE.test(e.url||e.pendingUrl||"")})).map((function(e){return b.tabDomain(e)})),r=y.filter((function(e){var t=n.findIndex((function(t){return t===b.tabDomain(e)}));return!(t>-1)||(n.splice(t,1),!1)})),[4,Promise.all(r.map((function(t){return h.btabs.create({active:!1,pinned:!0,url:t.url,windowId:e})})))];case 2:return a.sent(),y=[],N=!1,[2]}}))}))},t.lockVirtualGroups=function(e){A=Date.now()+e},t.unlockCloseLock=function(e){void 0===e&&(e=!1),S=!1,W&&(e||t.savePendingVirtualTabs.apply(void 0,u(W)),W=null)};t.claimVirtualGroup=function(e,n){if(e&&n){var r="tabcache"===e;if(r){if(!R)return;R=!1}var a=I.filter((function(t){return t.gId===e}));if(0!==a.length){var i=Object.values(w.getter.tabSet).filter((function(e){return!e.ignored&&e.windowId===n}));if(0!==i.length){var o=!r,c=a.reduce((function(e,t){var n=function(e,t,n){var r=e.tabs;if(!(r=r.filter((function(e){return!e.extensionDeferred})))||!t)return{score:0,virtualSet:e};if(n&&b.isUrlSubset(r,t))return{isSubset:!0,score:1e7*r.length,virtualSet:e};if(n&&b.isDomainSubset(r,t))return{isSubset:!0,score:1e4*r.length,virtualSet:e};var a=0,i=u(r),o=[],s=u(t);return[b.sanitizeUrl,b.urlPath,b.urlDomain].forEach((function(e,t){var n=[];s.forEach((function(r){var s=e(r.url||r.pendingUrl||""),u=i.findIndex((function(t){return e(t.url||"")===s}));u>-1?(a+=Math.pow(10,2-t),o.push([r.id,i[u].gId,i[u].id]),i.splice(u,1)):n.push(r)})),s=n})),{bindings:o,remainingTabs:s,score:a,virtualSet:e}}(t,i,o);return e?n.score>e.score?n:e:n}),null);if(c&&c.isSubset)i.forEach((function(t){return w.bindTab(t.id,e)})),I=I.filter((function(e){return e!==c.virtualSet}));else if(c&&c.bindings){c.bindings.forEach((function(e){var t=s(e,2),n=t[0],r=t[1];w.bindTab(n,r)})),t.removeVirtualTabs(c.bindings.map((function(e){return e[2]})));var l=c.remainingTabs,d=void 0===l?[]:l;!r&&d.length<i.length&&p.default.tabManagerOn&&d.forEach((function(t){return w.bindTab(t.id,e)}))}}}}},t.removeVirtualTabs=function(e){I=I.map((function(t){var n=t.tabs.filter((function(t){return!e.includes(t.id)}));return 0===n.length?null:{gId:t.gId,tabs:n,windowId:t.windowId}})).filter(b.compact)},t.checkForExtReload=function(){var e=l.default.groupBy(w.getter.tabSet,"windowId"),t=l.default.keyBy(w.getter.tabSet,"id"),n=s(l.default.partition(I,(function(e){return!e.unclaimed})),2),r=n[0],a=n[1];return!!r.every((function(n){var r=e[n.windowId];return!!(r&&n.tabs.every((function(e){return!!t[e.id]}))&&b.isDomainSubset(n.tabs,r))&&(console.log("virtual.checkForExtReload is subset",n.tabs,r),!0)}))&&(r.forEach((function(e){e.tabs.forEach((function(e){w.bindTab(e.id,e.gId)})),w.bindWindow(e.windowId,e.gId)})),I=a,w.emitChange(),w.emitChange.flush(),!0)};var x=!1;t.updateLockHandleSoloWindow=function(e){x=e},t.handleSoloWindow=l.default.debounce((function(){return a(void 0,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return x?[2]:[4,h.bwins.getAll()];case 1:return 1===(e=n.sent()).length&&p.default.tabManagerOn?[4,h.bwins.get(e[0].id,!0)]:[3,4];case 2:return(t=n.sent())&&t.tabs&&!t.tabs.find((function(e){return e.pinned}))?[4,w.ensureManager({windowId:t.id,focus:!1,useExtendedDef:!0})]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))}),2e3),h.bwins.onCreated.addListener((function(){t.handleSoloWindow()})),h.bwins.onRemoved.addListener((function(){return a(void 0,void 0,void 0,(function(){return i(this,(function(e){return S=!0,t.handleSoloWindow(),[2]}))}))})),v.onStartup((function(){I=f.default.get("virtual",[]).map(_),y=f.default.get("pnd",[]),t.handleSoloWindow()})),v.onShutdown((function(){R=!0,t.unlockCloseLock(!0),t.savePendingVirtualTabsThrottled.cancel(),t.lockVirtualGroups(5e3)})),v.onNotShutdown((function(){t.unlockCloseLock()}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.postMessageAllPorts=t.sendPortMessage=t.addPortMessageListener=void 0;var o=i(n(31)),s=n(0),u=n(3),c=n(2),l=i(n(4)),d=n(5),f=[],b={},h=[];t.addPortMessageListener=function(e){h.push(e)};var p=function(e,t){return r(void 0,void 0,void 0,(function(){var n,r,i;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),n=e.version||"0",o.default(n,"2.18.4")<0?(r=t.sender.tab,b[r.id]?[3,2]:(b[r.id]=!0,[4,c.btabs.reload(r.id)])):[3,2];case 1:a.sent(),a.label=2;case 2:return[3,4];case 3:return i=a.sent(),console.error("Error checking for web app update",i),[3,4];case 4:return h.forEach((function(n){return n(e,t)})),[2]}}))}))},v=function(e){f=f.filter((function(t){return t!==e}))},w=function(e){f.push(e),e.onMessage.addListener(p),e.onDisconnect.addListener(v)};chrome.runtime.onConnect.addListener(w),chrome.runtime.onConnectExternal.addListener(w),d.addTabListener((function(e,t,n){if(u.isActivated()){var r=!1;f.forEach((function(a){var i=null,o=null;try{var c=a.sender.tab;i=c.id,o=d.getTab(i).windowId||c.windowId}catch(e){}var f=!(r||!i||!o||!a.name.startsWith("manager"));a.postMessage({method:245,btabId:i,bwinId:o,clientId:u.EXT_CLIENT_ID,importWindowMeta:n?{height:32*n+16,url:chrome.runtime.getURL("importWindow.html")}:null,saveLock:f,sessionId:u.EXT_SESSION_ID,tabCacheSettings:l.default.update(),tabs:e,version:s.VERSION,virtualWindows:t,windowBindings:d.getWindowBindings()}),f&&(r=!0)}))}})),t.sendPortMessage=function(e,t){if(u.isActivated()){var n=null;return f.some((function(r){var a=((r.sender||{}).tab||{}).id;if(e===a){try{r.postMessage(t)}catch(e){n=e}return!0}return!1}))&&!n}},t.postMessageAllPorts=function(e){u.isActivated()&&f.forEach((function(t){if(t.name.startsWith("manager"))try{t.postMessage(e)}catch(e){}}))}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),c=n(3),l=n(2),d=s(n(4)),f=n(16),b=s(n(17)),h=n(5),p=n(6);l.bwins.onCreated.addListener((function(e){h.getter.windowIds[e.id]=!0})),l.bwins.onRemoved.addListener((function(e){delete h.getter.windowIds[e],Object.keys(h.getter.tabSrcWins).forEach((function(t){h.getter.tabSrcWins[t]===e&&delete h.getter.tabSrcWins[t]})),h.bindWindow(e,null),h.removeActiveTabIdForWindow(e)})),l.btabs.onCreated.addListener((function(e){var t=h.createTab(e);if(E(t.id,{},t),!t.pinned){var n=h.getter.windowBindings[t.windowId];if(n)h.bindTab(t.id,n);else{var r=void 0!==t.openerTabId&&h.getter.tabSet[t.openerTabId];r&&r.gId&&r.windowId===t.windowId&&h.bindTab(t.id,r.gId)}}}));var v=[],w={},E=function(e,t,n){if(u.REDIRECT_RE.test(n.url||n.pendingUrl||""))if(!1===t.discarded&&(clearTimeout(w[e]),delete w[e]),!1!==t.discarded){if(!v.includes(e)){var r=(f=c.parseQs(n.url||n.pendingUrl||"",!0)).favIconUrl&&f.favIconUrl!==n.favIconUrl,o=f.title&&f.title!==n.title;if(r||o)return v.push(e),v.length>100&&v.shift(),void l.btabs.reload(e).catch(console.warn)}if(!n.discarded&&!n.active&&!w[e]){var s=u.EXT_IS_FIREFOX?5e3:500,d=u.EXT_IS_FIREFOX?3e3:100;w[e]=window.setTimeout((function(){return a(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return h.getTab(e)?[4,l.btabs.discard(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return delete w[e],[2]}}))}))}),Math.floor(s+Math.random()*d))}}else{var f=c.parseQs(n.url||n.pendingUrl||"",!0);l.btabs.update(e,{url:f.url}).catch(console.warn)}};l.btabs.onUpdated.addListener((function(e,t,n){return a(void 0,void 0,void 0,(function(){var r;return i(this,(function(a){switch(a.label){case 0:if(!t.url)return[3,6];if(r=h.getter.tabSet[e]||{},!u.WEBAPP_RE.test(r.url||r.pendingUrl||"")||u.WEBAPP_RE.test(t.url)||r.url===t.url||u.ANY_EXT_RE.test(t.url))return[3,6];if(u.SITE_RE.test(t.url)&&(!u.TASKS_NOTES_RE.test(t.url)||!n.pinned))return[2,l.btabs.update(e,{pinned:!1})];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,l.btabs.goBack(e)];case 2:return a.sent(),[3,5];case 3:return a.sent(),[4,l.btabs.update(e,{url:r.url})];case 4:return a.sent(),[3,5];case 5:return[2,l.btabs.create({active:!0,openerTabId:e,url:t.url,windowId:n.windowId})];case 6:return n.favIconUrl||(n.favIconUrl=""),h.updateTab(e,n),("complete"===t.status||!1===t.discarded)&&E(e,t,n),[2]}}))}))})),l.btabs.onMoved.addListener((function(e,t){var n=t.windowId,r=t.toIndex;return a(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return h.updateTab(e,{index:r,windowId:n}),[4,l.bwins.get(n,!0)];case 1:return(t.sent().tabs||[]).forEach((function(e){h.updateTab(e.id,e,{checkEquals:!0})})),[2]}}))}))})),l.btabs.onActivated.addListener((function(e){var t=e.tabId,n=e.windowId;h.updateActiveTab(t,n),clearTimeout(w[t]),delete w[t]})),l.btabs.onDetached.addListener((function(e){h.updateTab(e)})),l.btabs.onAttached.addListener((function(e,t){var n=t.newWindowId,r=h.getter.windowBindings[n];"tabcache"!==r&&delete h.getter.tabSrcWins[e],h.updateTab(e,{windowId:n}),d.default.tabManagerOn&&h.bindTab(e,r)}));var _=null;l.btabs.onRemoved.addListener((function(e,t){var n=t.windowId,r=t.isWindowClosing;return a(void 0,void 0,void 0,(function(){var t;return i(this,(function(a){switch(a.label){case 0:return r?_===n?[3,3]:(_=n,(t=Object.values(h.getter.tabSet).filter((function(e){return e.windowId===n&&!u.ABOUT_RE.test(e.url||e.pendingUrl||"")}))).sort((function(e,t){return e.index-t.index})),n!==d.default.tabCacheWinId?[3,2]:[4,p.activateVirtualSet(n,"tabcache",t.filter((function(e){return!e.pinned})))]):[3,4];case 1:return a.sent(),[3,3];case 2:h.getter.lastClosedWindow={gId:h.getter.windowBindings[n],id:n,tabs:t},a.label=3;case 3:h.bindWindow(n,null),a.label=4;case 4:return h.removeTab(e),[2]}}))}))})),l.btabs.onReplaced.addListener((function(e,t){var n=h.getter.tabSet[t];n&&(delete h.getter.tabSet[t],h.getter.tabSrcWins[t]&&(h.getter.tabSrcWins[e]=h.getter.tabSrcWins[t],delete h.getter.tabSrcWins[t]),h.updateTab(e,r(r({},n),{id:e})))})),l.bwins.onFocusChanged.addListener((function(e){return a(void 0,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,l.bwins.get(e)];case 1:return(t=n.sent())&&t.focused&&"normal"===t.type&&(h.getter.lastFocusedWinId=e),[3,3];case 2:return n.sent(),[3,3];case 3:return[2]}}))}))}));f.onStartup((function(){a(void 0,void 0,void 0,(function(){var e,t,n,r,s,d,f,v,w,_,g,T,m,I,y,A,R,S,W,O,C,P,M,N,x,D,U;return i(this,(function(k){switch(k.label){case 0:return[4,l.bwins.getAll(!0)];case 1:e=k.sent(),t=[],n=[],k.label=2;case 2:k.trys.push([2,19,20,21]),r=o(e),s=r.next(),k.label=3;case 3:if(s.done)return[3,18];(d=s.value).state===u.MINIMIZED&&t.push(d.id),f=!1,v=d.tabs,w=void 0===v?[]:v,k.label=4;case 4:k.trys.push([4,15,16,17]),N=void 0,_=o(w),g=_.next(),k.label=5;case 5:return g.done?[3,14]:(T=g.value,m=T.url||T.pendingUrl||"",u.WEBAPP_RE.test(m)||u.TABCACHE_RE.test(m)?[3,6]:(h.createTab(T),T.active&&h.updateActiveTab(T.id,T.windowId),E(T.id,{},T),[3,13]));case 6:if(!f)return[3,11];k.label=7;case 7:return k.trys.push([7,9,,10]),[4,l.btabs.remove(T.id)];case 8:return k.sent(),[3,10];case 9:return I=k.sent(),console.warn(I),[3,10];case 10:return[3,12];case 11:n.push(T.id),k.label=12;case 12:f=!0,k.label=13;case 13:return g=_.next(),[3,5];case 14:return[3,17];case 15:return y=k.sent(),N={error:y},[3,17];case 16:try{g&&!g.done&&(x=_.return)&&x.call(_)}finally{if(N)throw N.error}return[7];case 17:return s=r.next(),[3,3];case 18:return[3,21];case 19:return A=k.sent(),P={error:A},[3,21];case 20:try{s&&!s.done&&(M=r.return)&&M.call(r)}finally{if(P)throw P.error}return[7];case 21:return R=function(){return a(void 0,void 0,void 0,(function(){var e,t,r,a,s,u;return i(this,(function(i){switch(i.label){case 0:i.trys.push([0,5,6,7]),e=o(n),t=e.next(),i.label=1;case 1:return t.done?[3,4]:(r=t.value,[4,l.btabs.reload(r)]);case 2:i.sent(),i.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return a=i.sent(),s={error:a},[3,7];case 6:try{t&&!t.done&&(u=e.return)&&u.call(e)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},p.checkForExtReload()?[3,32]:[4,R()];case 22:return k.sent(),[4,c.delay(500)];case 23:k.sent(),k.label=24;case 24:k.trys.push([24,29,30,31]),S=o(t),W=S.next(),k.label=25;case 25:return W.done?[3,28]:(O=W.value,[4,l.bwins.update(O,{state:u.NORMAL})]);case 26:k.sent(),k.label=27;case 27:return W=S.next(),[3,25];case 28:return[3,31];case 29:return C=k.sent(),D={error:C},[3,31];case 30:try{W&&!W.done&&(U=S.return)&&U.call(S)}finally{if(D)throw D.error}return[7];case 31:return[3,34];case 32:return u.EXT_IS_FIREFOX?[4,R()]:[3,34];case 33:k.sent(),k.label=34;case 34:return[4,b.default.init()];case 35:return k.sent(),[2]}}))})).catch(console.warn)}))},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function e(t){var n=t?parseInt(t,10):null;return null!==n?(n^16*Math.random()>>n/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e)};t.default=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.asynchrome=void 0;var u=s(n(1)),c=n(0),l=n(30);t.asynchrome=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r(void 0,void 0,void 0,(function(){var n;return a(this,(function(r){return(n=u.default.get(window.chrome,e))?[2,new Promise((function(r,a){n.apply(void 0,o(t,[function(t){chrome.runtime.lastError?a(new l.RuntimeError):t&&t.error?a(new Error("chrome."+e+": "+t.error.message)):r(t)}]))}))]:[2,Promise.reject(new Error("chrome."+e+" is not a valid API method."))]}))}))};var d=c.EXT_IS_FIREFOX?function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r(void 0,void 0,void 0,(function(){var n;return a(this,(function(r){return(n=u.default.get(window.browser,e))?[2,n.apply(void 0,o(t))]:[2,Promise.reject(new Error("browser."+e+" is not a valid API method."))]}))}))}:t.asynchrome;t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={set:function(e,t){null!=t?localStorage.setItem(e,JSON.stringify(t)):localStorage.removeItem(e)},exists:function(e){return void 0!==localStorage[e]},get:function(e,t){var n=null;try{n=JSON.parse(localStorage[e]||"")}catch(e){return t}return n},delete:function(e){localStorage.removeItem(e)}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isShutDown=t.onNotShutdown=t.onShutdown=t.onStartup=void 0;var o=i(n(1)),s=n(2),u=!0,c=o.default.debounce((function(){return r(void 0,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,s.bwins.getAll()];case 1:return 0===e.sent().length?u||(u=!0,f.forEach((function(e){return e()}))):b.forEach((function(e){return e()})),[2]}}))}))}),3e3),l=o.default.debounce((function(){return r(void 0,void 0,void 0,(function(){return a(this,(function(e){return u&&(u=!1,d.forEach((function(e){return e()}))),[2]}))}))}),500);s.bwins.onCreated.addListener((function(){l()})),s.bwins.onRemoved.addListener((function(){return r(void 0,void 0,void 0,(function(){return a(this,(function(e){return c(),[2]}))}))}));var d=[];t.onStartup=function(e){d.push(e)};var f=[];t.onShutdown=function(e){f.push(e)};var b=[];t.onNotShutdown=function(e){b.push(e)},t.isShutDown=function(){return u},l()},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TabCache=void 0;var c,l,d=u(n(1)),f=n(0),b=n(3),h=n(2),p=u(n(4)),v=n(7),w=n(5),E=n(6),_=!1,g=!1,T={},m=null,I=function(){function e(){this.spittingOutTabs=!1,this.minimize=d.default.debounce(this.minimize.bind(this),200),this.closeIfEmpty=d.default.debounce(this._closeIfEmpty.bind(this),2e3)}return Object.defineProperty(e.prototype,"disabled",{get:function(){return!p.default.tabCacheEnabled||!p.default.tabManagerOn},enumerable:!1,configurable:!0}),e.prototype.init=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o,s,u;return a(this,(function(a){switch(a.label){case 0:return e=w.getWindowBindings(),r=(n=d.default).keyBy,[4,h.bwins.getAll(!0)];case 1:return t=r.apply(n,[a.sent(),"id"]),(o=Object.entries(e).filter((function(e){var n=i(e,2),r=n[0];return"tabcache"===n[1]&&t[r]})).map((function(e){var n=i(e,1)[0];return t[n]}))[0])?(s=this.getManager(o.tabs),[4,this.initWindow(o.id,null==s?void 0:s.id)]):[3,3];case 2:return a.sent(),[3,5];case 3:return p.default.prevTabCacheWinId?[4,this.initWindow(p.default.prevTabCacheWinId,p.default.prevTabCacheManagerId)]:[3,5];case 4:a.sent(),p.default.tabCacheWinId&&!this.disabled&&E.claimVirtualGroup("tabcache",p.default.tabCacheWinId),a.label=5;case 5:return p.default.tabCacheWinId?[3,7]:(u=Object.values(t).reduce((function(e,t){return e.concat(t.tabs||[])}),[]).find((function(e){return f.TABCACHE_RE.test(e.url||"")})))?[4,this.verify(u.id,u.windowId)]:[3,7];case 6:a.sent(),a.label=7;case 7:return[2]}}))}))},e.prototype.initWindow=function(e,t){return r(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,h.bwins.get(e,!0)];case 1:return n=r.sent(),[3,3];case 2:return r.sent(),this.setWinId(null),[2];case 3:return T={},(n.tabs||[]).forEach((function(e){T[e.id]=!0})),this.setWinId(e),null!=t&&this.setTabId(t),[4,this._focusOnManager()];case 4:return r.sent(),[2]}}))}))},e.prototype.getWindow=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:if(!p.default.tabCacheWinId)return[2,null];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,h.bwins.get(p.default.tabCacheWinId,!!e||void 0)];case 2:return[2,t.sent()||null];case 3:return t.sent(),this.setWinId(null),[2,null];case 4:return[2]}}))}))},e.prototype.hasWindow=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.getWindow()];case 1:return[2,!!e.sent()]}}))}))},e.prototype.setWinId=function(e){p.default.tabCacheWinId=e||null,null!=e?w.bindWindow(e,"tabcache",!0):this.setTabId(null)},e.prototype.minimize=function(){if(p.default.tabCacheWinId)return h.bwins.update(p.default.tabCacheWinId,{state:f.MINIMIZED}).catch(d.default.noop)},e.prototype._focusOnManager=function(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return[4,this.getWindow(!0)];case 1:return(e=n.sent())?(t=this.getManager(e.tabs))?[3,3]:(g=!0,[4,h.btabs.create({active:!0,index:0,pinned:!0,url:f.TABCACHE_URL,windowId:e.id})]):[2];case 2:return t=n.sent(),this.setTabId(t.id),g=!1,[3,6];case 3:return t.active&&t.pinned?[3,6]:[4,h.btabs.update(t.id,{active:!0,pinned:!0})];case 4:return n.sent(),0===t.index?[3,6]:[4,h.btabs.move(t.id,{index:0})];case 5:n.sent(),n.label=6;case 6:return this.setTabId(t.id),[2]}}))}))},e.prototype.selfDestruct=function(){return r(this,void 0,void 0,(function(){var e,t,n,i,s,u,c=this;return a(this,(function(l){switch(l.label){case 0:return e=w.getLastClosedWindow(),t=[],n={},e&&(t.push.apply(t,o(e.tabs)),n[e.id]=e.gId||"temp_"+Math.floor((Date.now()-b.DAY_ZERO)/1e3)),i=Object.values(w.getter.tabSet).filter((function(e){return!f.TABCACHE_RE.test(e.url||e.pendingUrl||"")&&e.windowId===p.default.tabCacheWinId})),t.push.apply(t,o(i)),i.length>0&&null!==p.default.tabCacheWinId&&(n[p.default.tabCacheWinId]="tabcache"),E.unlockCloseLock(!0),E.savePendingVirtualTabsThrottled(t,n,!0),E.savePendingVirtualTabsThrottled.flush(),E.lockVirtualGroups(3e4),[4,h.btabs.remove(i.map((function(e){return e.id})))];case 1:return l.sent(),[4,this.getWindow(!0)];case 2:return(s=l.sent())?(p.default.tabCacheWinId=null,w.bindWindow(s.id,null),(u=this.getManager(s.tabs))?[4,h.btabs.update(u.id,{url:""+f.APP_PATH})]:[3,5]):[2];case 3:return l.sent(),[4,b.retryCondition((function(){return r(c,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,h.btabs.get(u.id)];case 1:return[2,"complete"===e.sent().status]}}))}))}),500,5e3)];case 4:l.sent(),l.label=5;case 5:return[4,b.delay(500)];case 6:return l.sent(),[4,h.bwins.remove(s.id)];case 7:return l.sent(),[2]}}))}))},e.prototype.verify=function(e,t){var n;return r(this,void 0,void 0,(function(){var r,i,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:return[4,h.bwins.get(t,!0)];case 1:r=a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,h.btabs.get(e)];case 3:return i=a.sent(),[3,5];case 4:return a.sent(),[2,!1];case 5:if(!(null===(n=r.tabs)||void 0===n?void 0:n.some((function(e){return f.WEBAPP_RE.test(e.url||e.pendingUrl||"")}))))return[3,10];a.label=6;case 6:return a.trys.push([6,8,,9]),[4,h.btabs.remove(e)];case 7:return a.sent(),[3,9];case 8:return o=a.sent(),console.warn(o),[3,9];case 9:return[2,!1];case 10:return i.pinned?[3,12]:[4,h.btabs.update(i.id,{pinned:!0})];case 11:a.sent(),a.label=12;case 12:return[4,h.bwins.getAll()];case 13:return s=a.sent(),u=s.length>1||(r.tabs||[]).length>1,this.disabled?[3,23]:t!==p.default.tabCacheWinId?[3,16]:1!==s.length?[3,15]:[4,h.bwins.create({url:f.APP_PATH})];case 14:a.sent(),a.label=15;case 15:return E.claimVirtualGroup("tabcache",t),[2,!0];case 16:return[4,this.hasWindow()];case 17:return a.sent()?[4,this.cache((r.tabs||[]).filter((function(t){return t.id!==e&&!b.isIgnored(t)})))]:[3,19];case 18:return a.sent(),[3,23];case 19:return c=this.getManager(r.tabs),[4,this.initWindow(t,null==c?void 0:c.id)];case 20:return a.sent(),1!==s.length?[3,22]:[4,h.bwins.create({url:f.APP_PATH})];case 21:a.sent(),a.label=22;case 22:return E.claimVirtualGroup("tabcache",t),[2,!0];case 23:return u?[4,h.btabs.remove(e)]:[3,25];case 24:return a.sent(),[3,27];case 25:return[4,h.btabs.update(e,{url:f.APP_PATH})];case 26:a.sent(),a.label=27;case 27:return[2,!1]}}))}))},e.prototype.ejectForeignTab=function(e,t){return r(this,void 0,void 0,(function(){var n,i=this;return a(this,(function(o){switch(o.label){case 0:if(this.disabled)return[2,null];if(f.TABCACHE_RE.test((null==t?void 0:t.url)||(null==t?void 0:t.pendingUrl)||"")||(null==t?void 0:t.id)===p.default.tabCacheManagerId)return[2,null];if(T[e])return[3,6];if(!m)return[3,5];o.label=1;case 1:return o.trys.push([1,4,,5]),[4,m];case 2:return n=o.sent(),[4,h.btabs.move(e,{windowId:n,index:-1})];case 3:return o.sent(),[3,5];case 4:return o.sent(),m=null,clearTimeout(this.foreignTimer),[2,this.ejectForeignTab(e,t)];case 5:return[2,m=new Promise((function(n){return r(i,void 0,void 0,(function(){var r;return a(this,(function(a){switch(a.label){case 0:return[4,h.bwins.create({tabId:e})];case 1:return r=a.sent(),clearTimeout(this.foreignTimer),this.foreignTimer=window.setTimeout((function(){m=null}),5e3),t&&t.pinned?[4,h.btabs.update(e,{pinned:!0})]:[3,3];case 2:a.sent(),a.label=3;case 3:return n(r.id),[2]}}))}))}))];case 6:return[2,null]}}))}))},e.prototype.cache=function(e){var t,n;return r(this,void 0,void 0,(function(){var r,o,u,c,l,b,v,E,_,g,m;return a(this,(function(a){switch(a.label){case 0:if(this.disabled)throw new Error("Tab cache is disabled");return e&&0!==e.length?null!=(r=p.default.tabCacheWinId)?[3,3]:[4,h.bwins.create({url:f.TABCACHE_URL})]:[2,[]];case 1:return o=a.sent(),[4,this.initWindow(o.id,null===(n=null===(t=o.tabs)||void 0===t?void 0:t[0])||void 0===n?void 0:n.id)];case 2:a.sent(),r=o.id,a.label=3;case 3:return w.bindWindow(r,"tabcache",!0),u=i(this.cacheableTabs(e),2),c=u[0],l=u[1],c.forEach((function(e){T[e.id]=!0})),c.length>0?[4,h.btabs.move(c.map((function(e){return e.id})),{windowId:r,index:-1})]:[3,5];case 4:a.sent(),a.label=5;case 5:return l.length>0?[4,h.btabs.remove(l.map((function(e){return e.id})))]:[3,7];case 6:a.sent(),a.label=7;case 7:a.trys.push([7,12,13,14]),b=s(c),v=b.next(),a.label=8;case 8:return v.done?[3,11]:(E=v.value,[4,(I=E.id,y={autoDiscardable:!0},h.btabs.update(I,y).catch(d.default.noop))]);case 9:a.sent(),a.label=10;case 10:return v=b.next(),[3,8];case 11:return[3,14];case 12:return _=a.sent(),g={error:_},[3,14];case 13:try{v&&!v.done&&(m=b.return)&&m.call(b)}finally{if(g)throw g.error}return[7];case 14:return w.autoDiscardTabs(),[2,c.map((function(e){return e.id}))]}var I,y}))}))},e.prototype.destroy=function(){return r(this,void 0,void 0,(function(){var e,t,n,o,u,c,l,b,p,v,E,_=this;return a(this,(function(g){switch(g.label){case 0:return[4,this.getWindow(!0)];case 1:if(!(e=g.sent()))return[2];t=function(e,t){return r(_,void 0,void 0,(function(){var n,r,o,u,c,l,d,f;return a(this,(function(a){switch(a.label){case 0:a.trys.push([0,5,6,7]),n=s(e.entries()),r=n.next(),a.label=1;case 1:return r.done?[3,4]:(o=i(r.value,2),u=o[0],c=o[1],u>0?[4,h.btabs.move(c.id,{windowId:t,index:-1})]:[3,3]);case 2:a.sent(),a.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return l=a.sent(),d={error:l},[3,7];case 6:try{r&&!r.done&&(f=n.return)&&f.call(n)}finally{if(d)throw d.error}return[7];case 7:return[2]}}))}))},n=(e.tabs||[]).filter((function(e){return!f.TABCACHE_RE.test(e.url||e.pendingUrl||"")})).map((function(e){return w.getTab(e.id)})),o=d.default.groupBy(n,"gId"),g.label=2;case 2:g.trys.push([2,8,9,10]),u=s(Object.values(o)),c=u.next(),g.label=3;case 3:return c.done?[3,7]:(l=c.value,[4,h.bwins.create({tabId:l[0].id})]);case 4:return b=g.sent(),[4,t(l,b.id)];case 5:g.sent(),g.label=6;case 6:return c=u.next(),[3,3];case 7:return[3,10];case 8:return p=g.sent(),v={error:p},[3,10];case 9:try{c&&!c.done&&(E=u.return)&&E.call(u)}finally{if(v)throw v.error}return[7];case 10:return[4,this._closeIfEmpty()];case 11:return g.sent()?[3,13]:[4,h.bwins.remove(e.id)];case 12:g.sent(),g.label=13;case 13:return[2]}}))}))},e.prototype._spitOutTabs=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:return[4,this.getWindow(!0)];case 1:return(n=a.sent())?(r=this.getManager(n.tabs))&&e===r.id?[2]:(i=w.getTab(e)||{},o=i.gId,s=void 0===o?null:o,u=i.pinned,c=void 0!==u&&u?"pinned":s||null,this.spittingOutTabs?[2]:(c||(c=w.tempId(),w.bindTab(e,c)),this.spittingOutTabs=!0,[4,this.ejectWorkspace(c,e,t)])):[2];case 2:return a.sent(),this.spittingOutTabs=!1,[2]}}))}))},e.prototype.openInWorkona=function(e,t){return this.ejectWorkspace(e,t)},e.prototype.cacheableTabs=function(e){return d.default.partition(e,(function(e){var t=e.url||e.pendingUrl||"";return!f.WEBAPP_EXT_RE.test(t)&&!f.NEWTAB_RE.test(t)}))},e.prototype.setTabId=function(e){p.default.tabCacheManagerId=e||null},e.prototype.getManager=function(e){return void 0===e&&(e=[]),e.find((function(e){return e.id===p.default.tabCacheManagerId}))||e.find((function(e){return f.TABCACHE_RE.test(e.url||e.pendingUrl||"")}))},e.prototype.ejectWorkspace=function(e,t,n){return r(this,void 0,void 0,(function(){var i,o,u,c,l,d,p,E,_,g,T,m,I,y,A,R,S,W,O,C,P=this;return a(this,(function(M){switch(M.label){case 0:return[4,this.getWindow(!0)];case 1:if(!(i=M.sent()))return[2];o=null,u=null,M.label=2;case 2:return M.trys.push([2,35,,36]),[4,h.bwins.getAll(!0)];case 3:return c=M.sent(),l=!1,(c=c.filter((function(e){return(e.tabs||[]).some((function(e){return f.WEBAPP_RE.test(e.url||e.pendingUrl||"")}))}))).length>0?(n?(u=n,o=c.find((function(e){return e.id===u}))||null):(d=Object.values(w.getter.tabSet).find((function(t){return t.gId&&t.gId===e})))&&d.srcWindowId&&(u=d.srcWindowId,o=c.find((function(e){return e.id===u}))||null),o||n||(c.sort((function(e,t){var n=e.tabs||[],r=t.tabs||[],a=n.filter((function(e){return e.pinned})).length,i=r.filter((function(e){return e.pinned})).length;if(n.length!==a||r.length!==i){if(n.length===a)return-1;if(r.length===i)return 1}return i-a})),o=c[0],u=o.id),(p=((null==o?void 0:o.tabs)||[]).find((function(e){return f.WEBAPP_RE.test(e.url||e.pendingUrl||"")})))&&v.sendPortMessage(p.id,{redirect:"/0/"+e.replace("temp_",""),redirectWait:!0})?(l=!0,[4,h.btabs.update(p.id,{active:!0})]):[3,5]):[3,5];case 4:M.sent(),t&&b.retryCondition((function(){return r(P,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return[4,h.btabs.get(t)];case 1:return e=n.sent(),o&&e.windowId===o.id?[4,h.btabs.update(t,{active:!0})]:[3,3];case 2:return n.sent(),[2,!0];case 3:return[2,!1]}}))}))}),500,5e3).catch(console.warn),M.label=5;case 5:if(l)return[3,34];if(o=null,!n)return[3,11];M.label=6;case 6:return M.trys.push([6,10,,11]),[4,h.bwins.get(n,!0)];case 7:return(o=M.sent())?[4,h.btabs.create({index:0,pinned:!0,url:f.APP_BASE_PATH+"0/",windowId:o.id})]:[3,9];case 8:M.sent(),M.label=9;case 9:return[3,11];case 10:return M.sent(),o=null,[3,11];case 11:return o?[3,14]:[4,h.bwins.create({url:f.APP_BASE_PATH+"0/"})];case 12:return o=M.sent(),[4,h.btabs.update(o.tabs[0].id,{pinned:!0})];case 13:M.sent(),M.label=14;case 14:return u=o.id,[4,this.cache((o.tabs||[]).filter((function(e){return!e.pinned})))];case 15:M.sent(),E=(i.tabs||[]).filter((function(e){return e.pinned&&!f.TABCACHE_RE.test(e.url||e.pendingUrl||"")})),M.label=16;case 16:M.trys.push([16,22,23,24]),_=s(E),g=_.next(),M.label=17;case 17:return g.done?[3,21]:(A=g.value,[4,h.btabs.move(A.id,{windowId:u,index:-1})]);case 18:return M.sent(),[4,h.btabs.update(A.id,{pinned:!0})];case 19:M.sent(),M.label=20;case 20:return g=_.next(),[3,17];case 21:return[3,24];case 22:return T=M.sent(),S={error:T},[3,24];case 23:try{g&&!g.done&&(W=_.return)&&W.call(_)}finally{if(S)throw S.error}return[7];case 24:m=(i.tabs||[]).map((function(e){return w.getTab(e.id)})).filter((function(t){return(t.gId||null)===e})),e&&w.bindWindow(u,e),M.label=25;case 25:M.trys.push([25,30,31,32]),I=s(m),y=I.next(),M.label=26;case 26:return y.done?[3,29]:(A=y.value,delete w.getter.tabSrcWins[A.id],[4,h.btabs.move(A.id,{windowId:u,index:-1})]);case 27:M.sent(),M.label=28;case 28:return y=I.next(),[3,26];case 29:return[3,32];case 30:return R=M.sent(),O={error:R},[3,32];case 31:try{y&&!y.done&&(C=I.return)&&C.call(I)}finally{if(O)throw O.error}return[7];case 32:return t?[4,h.btabs.update(t,{active:!0})]:[3,34];case 33:M.sent(),M.label=34;case 34:return[3,36];case 35:return M.sent(),[3,36];case 36:return null===u?[3,38]:[4,h.bwins.focus(u)];case 37:M.sent(),M.label=38;case 38:return[2,u]}}))}))},e.prototype._closeIfEmpty=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,this.getWindow(!0)];case 1:return(e=t.sent())?(e.tabs||[]).every((function(e){return f.TABCACHE_RE.test(e.url||e.pendingUrl||"")}))?[4,h.btabs.remove((e.tabs||[]).map((function(e){return e.id})))]:[3,3]:[2,!1];case 2:return t.sent(),[2,!0];case 3:return[2,!1]}}))}))},e}();t.TabCache=I;var y=new I,A=d.default.debounce((function(){return r(void 0,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,h.bwins.getAll()];case 1:return 1===(e=t.sent()).length&&e[0].id===p.default.tabCacheWinId?[2,y.selfDestruct()]:[2,null]}}))}))}),1e3);h.bwins.onRemoved.addListener((function(e){e===p.default.tabCacheWinId?(y.setWinId(null),_=!1,g=!1):A()})),h.bwins.onFocusChanged.addListener((function(e){return r(void 0,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return e!==p.default.tabCacheWinId&&(y.minimize(),e!==chrome.windows.WINDOW_ID_NONE&&(c=e)),e===chrome.windows.WINDOW_ID_NONE?[3,2]:[4,h.btabs.query({windowId:e,active:!0})];case 1:t=r.sent(),l=null===(n=t[0])||void 0===n?void 0:n.id,r.label=2;case 2:return[2]}}))}))})),h.btabs.onCreated.addListener((function(e){return r(void 0,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return p.default.tabCacheWinId!==e.windowId||g?[3,2]:[4,y.ejectForeignTab(e.id,e)];case 1:t.sent(),t.label=2;case 2:return w.autoDiscardTabs(),[2]}}))}))})),h.btabs.onUpdated.addListener((function(e,t,n){return r(void 0,void 0,void 0,(function(){var r;return a(this,(function(a){switch(a.label){case 0:return r=n.windowId===p.default.tabCacheWinId,e!==p.default.tabCacheManagerId||!t.url||f.TABCACHE_RE.test(t.url)?[3,4]:(y.setTabId(null),[4,y._focusOnManager()]);case 1:return a.sent(),[4,h.btabs.update(e,{pinned:!1})];case 2:return a.sent(),[4,y._spitOutTabs(e)];case 3:return a.sent(),[3,5];case 4:r&&t.pinned&&!y.disabled&&!f.TABCACHE_RE.test(n.url||n.pendingUrl||"")&&h.btabs.update(e,{pinned:!1}).catch(console.error),a.label=5;case 5:return r||!1!==t.discarded||w.autoDiscardTabs(),[2]}}))}))})),h.btabs.onActivated.addListener((function(e){var t=e.tabId,n=e.windowId;return r(void 0,void 0,void 0,(function(){var e,r,i;return a(this,(function(a){switch(a.label){case 0:return e=l,l=t,n!==p.default.tabCacheWinId?[3,4]:(r=!_,[4,y._focusOnManager()]);case 1:return a.sent(),r?(i=e===p.default.tabCacheManagerId?void 0:c,[4,y._spitOutTabs(t,i)]):[3,3];case 2:a.sent(),a.label=3;case 3:_=!1,a.label=4;case 4:return(p.default.tabTTL>-1||p.default.maxTabs>-1)&&w.autoDiscardTabs(),[2]}}))}))})),h.btabs.onAttached.addListener((function(e,t){var n=t.newWindowId;return r(void 0,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return p.default.tabCacheWinId!==n?[3,2]:[4,y.ejectForeignTab(e)];case 1:return t.sent(),[3,3];case 2:delete T[e],t.label=3;case 3:return[2]}}))}))})),h.btabs.onRemoved.addListener((function(e,t){var n=t.windowId;if(delete T[e],e===p.default.tabCacheManagerId&&(_=!0),n===p.default.tabCacheWinId)return y.closeIfEmpty()})),h.btabs.onReplaced.addListener((function(e,t){t in T&&(T[e]=!0,delete T[t])})),t.default=y},function(e,t,n){e.exports=n(19)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),n(8);var s,u=n(2),c=n(32),l=n(7),d=n(5),f=n(6),b=n(0),h=n(3),p=function(e,t,n){return h.isActivated()?(c.messageHandler(e,t).then((function(e){try{n({data:e,tab:t.tab&&d.isWorkonaWindow(t.tab.windowId)?t.tab:null,version:b.VERSION})}catch(e){console.warn("Error sending response",e.message)}})).catch((function(e){return console.error(e),n({error:{message:e.message}})})),!0):n({error:{activationUrl:chrome.runtime.getURL("activate.html"),message:"Extension not activated"}})};chrome.runtime.onMessage.addListener(p),chrome.runtime.onMessageExternal.addListener(p),chrome.browserAction.setPopup({popup:"popup.html"}),l.addPortMessageListener((function(e,t){h.isActivated()&&p(e,t.sender,(function(n){var r=n.data;t.postMessage({method:e.method,response:r})}))})),function(e){e.SWITCHER="switcher",e.SEARCH="search",e.CLOSE="close",e.CREATE_NEW="createNew"}(s||(s={}));var v=function(e){return r(void 0,void 0,void 0,(function(){var t,n,r,i,o;return a(this,(function(a){switch(a.label){case 0:return[4,d.getReliableCurrentWindow()];case 1:return t=a.sent(),n=t.tabs||[],r=(n.find((function(e){return e.active}))||{}).id,(i=n.find((function(e){return b.WEBAPP_RE.test(e.url||e.pendingUrl||"")})))&&l.sendPortMessage(i.id,((o={})[e]={tabId:r},o))?[2,u.btabs.update(i.id,{active:!0})]:[2,d.ensureManager({focus:!0,query:{action:e,tabId:""+r},windowId:t.id})]}}))}))};chrome.commands.onCommand.addListener((function(e){switch(e){case"manager":d.ensureManager({focus:!0}).catch(console.warn);break;case"switch":v(s.SWITCHER).catch(console.warn);break;case"search":v(s.SEARCH).catch(console.warn);break;case"new":v(s.CREATE_NEW).catch(console.warn);break;case"close":v(s.CLOSE).catch(console.warn)}return null}));chrome.contextMenus.create({id:"h2pc4r",contexts:["browser_action"],title:"Help center"}),chrome.contextMenus.create({id:"c5t",contexts:["browser_action"],title:"Email support"}),chrome.contextMenus.create({id:"f6k",contexts:["browser_action"],title:"Give feedback"}),b.EXT_IS_FIREFOX&&chrome.contextMenus.create({id:"p5ys6s",contexts:["browser_action"],title:"Privacy settings"}),chrome.contextMenus.create({id:"s2er4e",contexts:["browser_action"],title:"Remove from "+(b.EXT_IS_FIREFOX?"Firefox":b.EXT_IS_EDGE?"Microsoft Edge":"Chrome")+" (safely)..."}),chrome.contextMenus.onClicked.addListener((function(e){switch(e.menuItemId){case"h2pc4r":u.btabs.create({url:b.APP_BASE_PATH+"help/"}).catch(console.warn);break;case"c5t":u.btabs.create({url:b.APP_BASE_PATH+"contact/"}).catch(console.warn);break;case"f6k":u.btabs.create({url:b.APP_BASE_PATH+"feedback/"}).catch(console.warn);break;case"s2er4e":u.btabs.create({url:b.APP_BASE_PATH+"remove/"}).catch(console.warn);break;case"p5ys6s":u.btabs.create({url:chrome.runtime.getURL("activate.html?update=1")}).catch(console.warn)}}));chrome.runtime.onStartup.addListener((function(){})),chrome.runtime.onUpdateAvailable.addListener((function(){console.log("GOING TO RELOAD"),Promise.resolve().finally((function(){return chrome.runtime.reload()})).catch(console.warn)})),chrome.runtime.onInstalled.addListener((function(e){var t=e.reason;return r(void 0,void 0,void 0,(function(){var e,n,r,i,s,c,l,d;return a(this,(function(a){switch(a.label){case 0:return"install"!==t?[3,3]:(f.updateLockHandleSoloWindow(!0),setTimeout((function(){return f.updateLockHandleSoloWindow(!1)}),3e3),[4,u.bwins.getAll(!0)]);case 1:return e=a.sent(),[4,u.bwins.getCurrent(!0)];case 2:n=a.sent()||e.find((function(e){return e.focused}))||e[0],r=n.tabs||[],i=b.EXT_IS_FIREFOX?["/firefox/addon/workona/","://addons.mozilla.org/"]:b.EXT_IS_EDGE?[b.EDGE_EXT_ID,"://microsoftedge.microsoft.com/addons"]:[b.CHROME_EXT_ID,"://chrome.google.com/webstore"],s=function(e){var t=e.url||e.pendingUrl||"";return i.every((function(e){return t.indexOf(e)>-1}))},c=b.EXT_IS_FIREFOX?chrome.runtime.getURL("activate.html"):b.APP_BASE_PATH+"installed/",(l=r.find(s))||(d=e.reduce((function(e,t){return t.id!==n.id&&e.push.apply(e,o(t.tabs||[])),e}),[]),l=l||d.find(s));try{return l?[2,u.btabs.update(l.id,{active:!0,url:c})]:[2,u.btabs.create({active:!0,url:c,windowId:n.id})]}catch(e){console.error(e)}a.label=3;case 3:return[2]}}))}))})),chrome.runtime.setUninstallURL(b.APP_BASE_PATH+"extension-feedback/")},,,,,,,,,,,function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.CodedError=t.APIError=t.RuntimeError=void 0;var i=function(e){function t(){var t,n=e.call(this,((null===(t=null===chrome||void 0===chrome?void 0:chrome.runtime)||void 0===t?void 0:t.lastError)||{}).message)||this;return n.name="RuntimeError",n}return a(t,e),t}(Error);t.RuntimeError=i;var o=function(e){function t(t,n,r,a){var i=e.call(this,t)||this;return i.name="APIError",i.status=n,i.code=r,i.data=a,i}return a(t,e),t}(Error);t.APIError=o;var s=function(e){function t(t,n){var r=e.call(this,t)||this;return r.code=n,r}return a(t,e),t}(Error);t.CodedError=s},,function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.messageHandler=void 0;var l=c(n(1)),d=c(n(14)),f=n(0),b=n(3),h=c(n(13));n(8);var p=n(2),v=c(n(4)),w=n(7),E=c(n(17)),_=n(5),g=n(6),T={origins:["<all_urls>"]},m=function(e,t){var n=(Array.isArray(t)?t:[t]).filter((function(t){return(null==e?void 0:e.id)===t||!w.sendPortMessage(t,{btabId:t,closeYourself:!0})}));return p.btabs.remove(n)},I=function(e){return a(void 0,void 0,void 0,(function(){var t,n,r,a,u,c,l,b;return i(this,(function(i){switch(i.label){case 0:return[4,E.default.destroy()];case 1:return i.sent(),[4,_.getAllTabs()];case 2:t=o.apply(void 0,[i.sent(),1]),n=t[0],i.label=3;case 3:i.trys.push([3,8,9,10]),r=s(n),a=r.next(),i.label=4;case 4:return a.done?[3,7]:(u=a.value).pinned&&f.WEBAPP_RE.test(u.url||u.pendingUrl||"")?[4,p.btabs.update(u.id,{pinned:!1})]:[3,6];case 5:i.sent(),i.label=6;case 6:return a=r.next(),[3,4];case 7:return[3,10];case 8:return c=i.sent(),l={error:c},[3,10];case 9:try{a&&!a.done&&(b=r.return)&&b.call(r)}finally{if(l)throw l.error}return[7];case 10:return[4,d.default("runtime.setUninstallURL","")];case 11:return i.sent(),[4,p.btabs.update(e.id,{url:f.EXTENSION_FEEDBACK_URL})];case 12:return i.sent(),[4,p.bwins.focus(e.windowId)];case 13:return i.sent(),[4,d.default("management.uninstallSelf")];case 14:return i.sent(),[2]}}))}))},y={},A=function(e,t){void 0===t&&(t=5e3);var n=h.default(),r={id:n,method:f.ExtensionMessage.QUERY_CLIENT,query:e};return w.postMessageAllPorts(r),new Promise((function(e,r){y[n]={reject:r,resolve:e},setTimeout((function(){y[n]&&(y[n].reject(new Error("timeout")),delete y[n])}),t)}))},R=!1,S=function(e,t){return a(void 0,void 0,void 0,(function(){var n,r,a,o,s,c,l,h,p,v,w,g,T,I;return i(this,(function(i){switch(i.label){case 0:switch(n=e.args,r=e.path,a=e.fromWebClient,r){case"history.search":return[3,1];case"windows.create":return[3,2];case"windows.get":case"windows.getCurrent":case"windows.update":return[3,4];case"windows.remove":return[3,6];case"windows.getAll":return[3,7];case"windows.getCurrentFromPopup":return[3,9];case"tabs.create":return[3,11];case"tabs.discard":return[3,13];case"tabs.get":return[3,15];case"tabs.highlight":return[3,17];case"tabs.move":return[3,19];case"tabs.query":return[3,21];case"tabs.reload":return[3,23];case"tabs.getCurrentFromPopup":return[3,24];case"tabs.hide":return[3,26];case"tabs.show":return[3,27];case"tabs.remove":return[3,28];case"tabs.update":return[3,29];case"management.uninstallSelf":return[3,30]}return[3,32];case 1:return f.WORKONA_MANAGED?[2,[]]:[2,d.default.apply(void 0,u([r],n))];case 2:return[4,d.default.apply(void 0,u([r],n))];case 3:return[2,(s=i.sent())&&b.cleanWindow(s)];case 4:return[4,d.default.apply(void 0,u([r],n))];case 5:if(s=i.sent(),f.WORKONA_MANAGED&&!_.isWorkonaWindow(s.id))throw new Error("Current window is not managed by Workona");return[2,b.cleanWindow(s)];case 6:return[2,d.default.apply(void 0,u([r],n))];case 7:return[4,d.default.apply(void 0,u([r],n))];case 8:return o=i.sent(),f.WORKONA_MANAGED?[2,o.filter((function(e){return _.isWorkonaWindow(e.id)})).map(b.cleanWindow)]:[2,o.map(b.cleanWindow)];case 9:return[4,_.getReliableCurrentWindow()];case 10:if(s=i.sent(),f.WORKONA_MANAGED&&!_.isWorkonaWindow(s.id))throw new Error("Current window is not managed by Workona");return[2,b.cleanWindow(s)];case 11:if(c=n[0]||{},l=c.windowId,f.WORKONA_MANAGED&&(!l||a&&!_.isWorkonaWindow(l)))throw new Error("You must specify a window managed by workona to create a tab");return h=b.cleanTab,[4,d.default.apply(void 0,u([r],n))];case 12:return[2,h.apply(void 0,[i.sent()])];case 13:return[4,d.default.apply(void 0,u([r],n))];case 14:return[2,(g=i.sent())?b.cleanTab(g):null];case 15:return p=b.cleanTab,[4,d.default.apply(void 0,u([r],n))];case 16:return[2,p.apply(void 0,[i.sent()])];case 17:return[4,d.default.apply(void 0,u([r],n))];case 18:return i.sent(),[2];case 19:return[4,d.default.apply(void 0,u([r],n))];case 20:return v=i.sent(),w=Array.isArray(v)?v:[v],f.WORKONA_MANAGED?[2,w.filter((function(e){return _.isWorkonaWindow(e.windowId)})).map(b.cleanTab)]:[2,w.map(b.cleanTab)];case 21:return[4,d.default.apply(void 0,u([r],n))];case 22:return w=i.sent(),f.WORKONA_MANAGED?[2,w.filter((function(e){return _.isWorkonaWindow(e.windowId)})).map(b.cleanTab)]:[2,w.map(b.cleanTab)];case 23:return[2,d.default.apply(void 0,u([r],n))];case 24:return[4,_.getReliableCurrentTab()];case 25:if(g=i.sent(),f.WORKONA_MANAGED&&g&&!_.isWorkonaWindow(g.windowId))throw new Error("Current window is not managed by Workona");return[2,g&&b.cleanTab(g)];case 26:return[2,_.hideTabs(E.default,t.tab,n[0])];case 27:return[2,_.showTabs(E.default,n[0],n[1])];case 28:return[2,m(t.tab,n[0])];case 29:return[2,d.default.apply(void 0,u([r,null!==(T=n[0])&&void 0!==T?T:null===(I=t.tab)||void 0===I?void 0:I.id],n.slice(1)))];case 30:return[4,d.default("runtime.setUninstallURL","")];case 31:return i.sent(),[2,d.default.apply(void 0,u([r],n))];case 32:if(f.WORKONA_MANAGED)throw new Error("API "+r+" not allowed");return[2,d.default.apply(void 0,u([r],n))]}}))}))};t.messageHandler=function(e,t){return a(void 0,void 0,void 0,(function(){var n,u,c,h,m,W,O,C,P,M,N,x,D,U,k;return i(this,(function(L){switch(L.label){case 0:switch(e.method){case f.ExtensionMessage.FAV_ICON_URL:return[3,1];case f.ExtensionMessage.CURRENT_TAB:return[3,2];case f.ExtensionMessage.CMD_LIST:return[3,3];case f.ExtensionMessage.TAB_CACHE_SETTINGS:return[3,4];case f.ExtensionMessage.ENSURE_MANAGER:return[3,5];case f.ExtensionMessage.DISCARD_TABS:return[3,6];case f.ExtensionMessage.SYSTEM_MEMORY:return[3,8];case f.ExtensionMessage.ASYNCHROME:return[3,9];case f.ExtensionMessage.UPDATE_TAB:return[3,10];case f.ExtensionMessage.BIND_WINDOW:return[3,11];case f.ExtensionMessage.BIND_TABS:return[3,12];case f.ExtensionMessage.CREATE_AND_BIND_TABS:return[3,13];case f.ExtensionMessage.QUERY_CLIENT:return[3,14];case f.ExtensionMessage.CLIENT_QUERY_RESPONSE:return[3,15];case f.ExtensionMessage.VERIFY_TAB_CACHE:return[3,16];case f.ExtensionMessage.BTN_DRAW_ATTENTION:return[3,17];case f.ExtensionMessage.REMOVE_EXTENSION:return[3,18];case f.ExtensionMessage.SEND_PORT_MESSAGE:return[3,19];case f.ExtensionMessage.HANDLE_URLS_PERMISSION:return[3,20];case f.ExtensionMessage.UPDATE_VIRTUAL_TABS:return[3,21];case f.ExtensionMessage.OPEN_IN_WORKONA:return[3,22];case f.ExtensionMessage.ACTIVATE_VIRTUAL_SET:return[3,23];case f.ExtensionMessage.UPDATE_NEWTAB_SETTINGS:return[3,24];case 245:return[3,25];case f.ExtensionMessage.SET_ICON:return[3,27];case f.ExtensionMessage.UNMANAGED_WINDOWS:case f.ExtensionMessage.IS_CURRENT_WINDOW_MANAGED:return[3,28]}return[3,29];case 1:return[2,(X=e.url,new Promise((function(e,t){var n=new Image;n.onload=function(){if(n){var t=n.naturalWidth||16,r=n.naturalHeight||16,a=document.createElement("canvas");a.width=t,a.height=r;var i=a.getContext("2d");i&&i.drawImage(n,0,0,t,r),e(a.toDataURL()),a=null,n=null}},n.onerror=function(e){n=null,t(e)},n.src="chrome://favicon/size/16@2x/"+X})))];case 2:return[2,t.tab];case 3:return[2,d.default("commands.getAll")];case 4:return n=v.default.update(e.settings),_.emitChange(),[2,n];case 5:return[2,_.ensureManager({focus:null===(U=e.focus)||void 0===U||U,query:e.query||{},verifyWindow:!0,windowId:e.windowId,workspaceId:e.workspaceId})];case 6:return u=e.btabIds||(t.tab?[t.tab.id]:[]),h=_.discardableTabs,[4,_.getAllTabs()];case 7:return c=h.apply(void 0,[L.sent()[0]]),e.exclude?[2,Promise.all(c.map((function(e){if(!f.WORKONA_MANAGED||_.isWorkonaWindow(e.windowId))return u.includes(e.id)?void 0:p.btabs.discard(e.id).catch(l.default.noop)})))]:[2,Promise.all(c.map((function(e){if(u.includes(e.id))return p.btabs.discard(e.id).catch(l.default.noop)})))];case 8:return[2,d.default("permissions.request",{permissions:["system.memory"]}).then((function(){return d.default("system.memory.getInfo")}))];case 9:return[2,S(e,t)];case 10:return[2,p.btabs.update(e.btabId,e.updates)];case 11:return _.bindWindow(e.bwinId,e.groupId||e.gId),[2];case 12:return e.btabIds.forEach((function(t){_.bindTab(t,e.groupId||e.gId)})),[2];case 13:return[2,new Promise((function(t,n){return a(void 0,void 0,void 0,(function(){var r,a,o,u,c,l,d,b,h,v,w,E,g,T;return i(this,(function(i){switch(i.label){case 0:r=e.props;try{for(a=s(r),o=a.next();!o.done;o=a.next())if(u=o.value.windowId,f.WORKONA_MANAGED&&(!u||!_.isWorkonaWindow(u)))return n(new Error("You must specify a window managed by workona to create a tab")),[2]}catch(e){w={error:e}}finally{try{o&&!o.done&&(E=a.return)&&E.call(a)}finally{if(w)throw w.error}}c=[],i.label=1;case 1:i.trys.push([1,6,7,8]),l=s(r),d=l.next(),i.label=2;case 2:return d.done?[3,5]:(b=d.value,[4,p.btabs.create(b)]);case 3:h=i.sent(),_.bindTab(h.id,e.groupId||e.gId),c.push(h),i.label=4;case 4:return d=l.next(),[3,2];case 5:return[3,8];case 6:return v=i.sent(),g={error:v},[3,8];case 7:try{d&&!d.done&&(T=l.return)&&T.call(l)}finally{if(g)throw g.error}return[7];case 8:return t(c),[2]}}))}))}))];case 14:return[2,A(e.query,e.timeout)];case 15:return j=e.id,F=e.response,y[j]&&(y[j].resolve(F),delete y[j]),[2];case 16:return[2,E.default.verify(t.tab.id,t.tab.windowId)];case 17:return[2,(H=e.on,R=void 0!==H?!!H:!R)];case 18:return[2,I(t.tab)];case 19:if(w.sendPortMessage(e.tabId,e.message))return[2];throw new Error("Could not send port message");case 20:return[2,(B=e.check,a(void 0,void 0,void 0,(function(){return i(this,(function(e){return B?[2,d.default("permissions.contains",T)]:[2,d.default("permissions.request",T)]}))})))];case 21:return e.remove?(g.removeVirtualTabs(e.remove),_.emitChange(),[2]):e.claimGroup?(g.claimVirtualGroup(e.claimGroup,t.tab?t.tab.windowId:null),_.emitChange(),[2]):e.restorePinned?[2,g.restoreVirtualPinned(t.tab?t.tab.windowId:null)]:[3,30];case 22:return[2,E.default.openInWorkona(e.groupId||e.gId,e.tabId)];case 23:return m=e.tabIds.map((function(e){return _.getTab(e)})),W=o(E.default.cacheableTabs(m),1),O=W[0],[2,g.activateVirtualSet(e.windowId||(null===(k=t.tab)||void 0===k?void 0:k.windowId),e.groupId||e.gId,O)];case 24:return function(e){var t={};try{t=JSON.parse(localStorage.settings)}catch(e){console.warn(e)}try{t=r(r({},t),e),localStorage.settings=JSON.stringify(t)}catch(e){console.warn(e)}}(e.settings),[2];case 25:return[4,_.getAllProcessedTabs()];case 26:return C=o.apply(void 0,[L.sent(),2]),P=C[0],M=C[1],N=t.tab&&_.isWorkonaWindow(t.tab.windowId)?t.tab:null,x=N?N.id:null,D=N?N.windowId:null,[2,{btabId:x,bwinId:D,clientId:b.EXT_CLIENT_ID,importWindowMeta:M?{height:32*M+16,url:chrome.runtime.getURL("importWindow.html")}:null,sessionId:b.EXT_SESSION_ID,tabCacheSettings:v.default.update(),tabs:P,version:f.VERSION,virtualWindows:g.getProcessedVirtualWindows(),windowBindings:_.getWindowBindings()}];case 27:return function(e){if(e){var t=e===f.PopoverType.SAVE?"bookmark":e===f.PopoverType.MOVE?"move":"send";chrome.browserAction.setIcon({path:"images/"+t+"_btn.png"})}}(e.iconType),[2];case 28:if(e.fromWebClient)throw new Error("Method not allowed from web client ("+e.method+")");return e.method===f.ExtensionMessage.IS_CURRENT_WINDOW_MANAGED?[2,_.isCurrentWindowManagedByWorkona()]:[2,_.getUnmanagedWindows()];case 29:throw new Error("Invalid method ("+e.method+")");case 30:return[2]}var B,H,j,F,X}))}))}}],[[18,1,2]]]);