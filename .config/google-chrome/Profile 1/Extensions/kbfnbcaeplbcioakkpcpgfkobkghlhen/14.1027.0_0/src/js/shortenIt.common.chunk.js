(self.webpackChunk=self.webpackChunk||[]).push([[7272],{51972:(e,t,i)=>{i.d(t,{O:()=>K});var s=i(57050),a=i(35214),n=i(40327),r=i(54483),o=i(31820),l=i(35108),d=i(77176),c=i(40151),u=i(2834),m=i(55415),p=i(22232),h=i(5114),g=i(32821),S=i(27378),v=i(30763),y=i(7046),C=i(21474),f=i(3656),A=i(28706),k=i(26027),b=i(15646),I=i(74754),w=i(66346),_=i(76974),R=i(5739),E=i(16314),q=i(35501),F=i(35630),T=i(32585);const x=g.UI.Node.make((({state:e,notify:t})=>{const i=S.useContext(v.m.Context);return S.createElement(R.F.Fragment,null,e.pipe(d.U((e=>(0,s.pipe)(e.details,h.fold((()=>S.createElement("div",null)),(()=>S.createElement(y.zx.Tertiary,{key:"toggle-more",name:(0,w.hC)(e.visualState,i),title:(0,w.hC)(e.visualState,i),onClick:A.hz(t({type:b.eI.Kind.startTransitionTo,id:e.id,transition:{type:k.X.isCardOpen(e.visualState)?"focused":"expanded",clockwise:!0}}))},k.X.isCardOpen(e.visualState)?S.createElement(C.JO.Arrow,{key:"more",className:T.lessIcon}):S.createElement(C.JO.QuestionMark,{key:"expand"}),(0,w.hC)(e.visualState,i)))))))))})),U=g.UI.Node.make((({notify:e})=>S.createElement(y.zx.Tertiary,{name:"dismiss",title:"Dismiss",onClick:A.hz(e({type:E.Dy.ignoreButtonClick}))},S.createElement(C.JO.Ignore,null)))),B=g.UI.Node.make((({state:e})=>S.createElement(R.F.Fragment,null,e.pipe(d.U((e=>(0,s.pipe)(e.details,h.fold(s.constNull,(t=>S.createElement(w.G3,{key:"card-actions-details",visualState:e.visualState,className:T.more},S.createElement(f.XY,{className:T.minimalDescription,...I.y.renderToHtml(t)}))))))))))),N=g.UI.Node.make((({notify:e})=>S.createElement(y.zx.Flat,{className:T.feedbackFooter,name:"attention-score-card-open-feedback-form",onClick:A.hz(e({type:E.Dy.feedbackButtonClick}))},S.createElement("span",null,"Anything we can improve?"),S.createElement(C.JO.SmartPhrases.OpenFeedbackFormArrow,null)))),O=g.UI.Node.make((({state:e,notify:t})=>S.createElement(R.F.Fragment,null,e.pipe(d.U((e=>S.createElement(y.zx.Primary,{name:"readersAttentionItem-view-more",onClick:A.hz(t({type:E.Dy.viewMoreButtonClick,item:e})),className:T.viewMoreButton},"See suggestions"))))))),P=g.UI.Knot.make(g.UI.Grid.make((({slots:e})=>S.createElement(R.F.div,{className:F.card,"data-name":"attention-score-card-full"},e.header,S.createElement(R.F.div,{className:T.cardBody},e.content,e.details,S.createElement("div",{className:T.actions},e.viewMoreButton)),S.createElement(R.F.div,{className:T.actionsFooter},e.expandButton,e.dismissButton),e.feedbackFooter))),{header:(0,q.h)("full"),content:q.r,details:B,expandButton:x,dismissButton:U,viewMoreButton:O,feedbackFooter:N}),H=e=>g.Z.composeKnot({header:()=>e,content:()=>e.pipe(d.U((e=>({attentionScore:e.attentionScore,description:e.description})))),details:()=>e,expandButton:()=>e,dismissButton:()=>_.of(null),viewMoreButton:g.Z.fromSideEffect(s.constVoid,e),feedbackFooter:()=>_.of(null)});var Q=i(12187),M=i(65060),X=i(11510);const D=g.UI.Knot.make(g.UI.Grid.make((({slots:e,notify:t})=>S.createElement(R.F.div,{"data-name":"attention-score-card-mini",onClick:A.hz(t({type:E.Dy.miniCardClick,id:M.g.id})),...(0,Q.Sh)(F.card,X.miniCard)},e.header))),{header:(0,q.h)("mini")}),V=e=>g.Z.composeKnot({root:g.Z.fromSideEffect(s.constVoid,null),header:()=>e});var W;!function(e){const t=g.UI.Union.make("kind",{mini:D,full:P,hidden:g.UI.Node.empty}),i=e=>({mini:V(e.pipe(d.U((e=>({title:e.view.title,attentionScore:e.view.attentionScore,density:e.density}))))),full:H(e.pipe(d.U(m.pick("view")))),hidden:()=>c.E}),a=r.G.make(t);function n(e){switch(e){case"added":case"rendered":return"mini";case"focused":case"expanded":return"full";case"hidden":case"removed":return"hidden";case"presuccess":case"success":case"feedback_form":case"muted":throw new Error(`${e} is not supported for ReadersAttentionCard`);default:(0,p.vE)(e)}}e.Card=g.UI.Node.make((({state:e,notify:t})=>g.UI.mount(a,(0,s.pipe)(o.g.flow(e.pipe(d.U(m.pick("view"))),(0,s.pipe)((e=>g.Z.composeUnion(i(e),(()=>e.pipe(d.U((e=>({kind:n(e.view.visualState.transition.type)})))))))(e),g.Z.extendActions(u.b((e=>t(e.action.action)())))),(e=>g.Z.composeUnion(i(e),(()=>e.pipe(d.U((e=>({kind:(0,s.pipe)(e.view.visualState.from,h.fold((()=>"mini"),n))})))))))(e),m.pick("id"),l.CE.toOption(l.a)),o.g.extend((e=>t(e)()))))))}(W||(W={}));var L=i(48521),G=i(16892);const Y=e=>t=>({...t,positionState:e}),z=e=>t=>({...t,visualState:e});var K,J=i(66896),Z=i(22373),$=i(7910),j=i(49978),ee=i(84974),te=i(98752),ie=i(17594),se=i(91549),ae=i(20594),ne=i(86775),re=i(75316),oe=i(15215),le=i(70100),de=i(47306),ce=i(35416),ue=i(25975),me=i(8125),pe=i(83078),he=i(73975),ge=i(45701),Se=i(31881);!function(e){function t(e,t,i,s,a){return ce.nL.Items.mapper((e=>e.kind),{[k.X.Kind]:e,[se.R.Kind]:t,[le.X.kind]:i,[de.J.kind]:s,[M.g.kind]:a})}function i(e){return e.kind===k.X.Kind}function r(e){return e.kind===se.R.Kind}function o(e){return i(e)&&re.C.isEthicalAIItem(e)}function l(e){return r(e)&&re.C.isEthicalAIItem(e)}function d(i,s){return(0,$.Pv)(e.disposable,((e,a)=>t((t=>({view:t,isLastCard:e,kind:"alertCard",visibleViewportHeight:i(a)})),(t=>({view:t,isLastCard:e,kind:"alertsBundle",visibleViewportHeight:i(a)})),(e=>({view:e,kind:"checklistItemEmpty"})),(t=>({view:t,kind:"checklistItemWithAlerts",isLastCard:e,visibleViewportHeight:i(a)})),(e=>({density:s()===J.R.SpecialId.AllAlerts?"normal":"compact",view:e,kind:"readersAttentionItem"})))))}e.isSelectableWithAlertItem=(0,me.Kg)(i,r,oe.d.isChecklistItemWithAlerts),e.getActiveItemWithAlert=ce.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.getActiveAlignableItem=ce.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.getActiveFocusableItem=ce.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.checksFeedItemsMapper=t,e.isAlertCard=i,e.isAlertsBundle=r,e.isEthicalAIAlertCard=o,e.isEthicalAIAlertsBundle=l,e.defaultOrd=(0,a.fold)(ge.getMonoid())([(0,n.pipe)(ge.ordBoolean,ge.contramap((0,me.ff)(o))),(0,n.pipe)(ge.ordBoolean,ge.contramap(M.m)),ge.fromCompare(((e,t)=>i(e)&&i(t)?k.X.ord.compare(e,t):0))]),e.bundlesOrd=(0,a.fold)(ge.getMonoid())([(0,n.pipe)(ge.ordBoolean,ge.contramap((0,me.ff)(l))),(0,n.pipe)(ge.ordBoolean,ge.contramap(M.m)),ge.fromCompare(((e,t)=>r(e)&&r(t)?se.R.ord.compare(e,t):0))]),e.item=e=>Se.UI.Union.make("kind",{alertCard:Z.p.Card(e),alertsBundle:j.Q.Card(e),checklistItemEmpty:ee.z.Card(e),checklistItemWithAlerts:te.fw.Card(e),readersAttentionItem:W.Card}),e.viewState=d,e.createCardListFlow=e=>(0,$.sJ)((t=>(0,n.pipe)(e,pe.tap((e=>e.actions.next(t.action)))))),e.listItemOrd=e=>ge.contramap((e=>e.cell.item.view))(e).compare;const c={equals:(e,t)=>e.kind===t.kind&&G.s.eqById.equals(e,t)},u=(e,t,i,s,a)=>({equals:(n,r)=>{const o={[k.X.Kind]:e,[se.R.Kind]:t,[le.X.kind]:i,[de.J.kind]:s,[M.g.kind]:a};return c.equals(n,r)&&function(e,t){return(i,s)=>t[e(i)].equals(i,s)}((e=>e.kind),o)(n,r)}}),m=(0,a.fold)(he.getMonoid())([L.o.eq,G.s.verticalPositionEq,c]);function p(e,i){const s=k.X.Capabilities.getChangePosition(e);return{changePosition:e=>t(s.changePosition(e),se.R.changePosition(e),le.X.changePositionState(e),i.changePositionState(e),Y(e))}}function g(e,i,s){const a=k.X.Capabilities.getAnimatable(e),n=se.R.Capabilities.getAnimatable(s);return{completeTransition:e=>{return t(a.completeTransition(e),n.completeTransition(e),le.X.completeTransition(e),i.completeTransition(e),(s=e,e=>({...e,visualState:L.o.VisualState.complete(e.visualState,s)})));var s},transitionTo:e=>t(a.transitionTo(e),n.transitionTo(e),le.X.transitionTo(e),i.transitionTo(e),(e=>t=>({...t,visualState:L.o.VisualState.to(t.visualState,e)}))(e)),changeVisualState:e=>t(a.changeVisualState(e),n.changeVisualState(e),le.X.changeVisualState(e),i.changeVisualState(e),z(e))}}function S(e,i,a,r,o){const l=se.R.getCardHydrator(o),d=se.R.getSelect(a,r,l),c=se.R.getSelectByAlert(a,r,l),u=k.X.Capabilities.getSelect(e);return{select:(e,a)=>t(u.select(e,a),d(e,a),le.X.select(e),i.selectFirstAlert((0,s.unsafeCoerce)(e),a),function(e,t){return i=>{const a=(0,n.pipe)(e,h.map((e=>t.compare(i,e)>0)),h.getOrElse(s.constTrue)),r=(0,n.pipe)(e,h.exists((e=>e.id===i.id))),o=r&&k.X.isCardOpen(i.visualState)?"expanded":"focused",l=(0,n.pipe)(e,h.fold((()=>L.o.VisualState.initial({type:o,clockwise:a})),(e=>L.o.VisualState.to(i.visualState,{type:o,clockwise:a}))));return(0,n.pipe)(i,r?s.identity:Y(G.s.PositionState.invalidateHeight(i.positionState)),z(l))}}(e,a)),selectByAlert:(e,a,n)=>t(u.selectByAlert(e,a,n),c(a,e,n),le.X.select(e),i.selectByAlert(a,(0,s.unsafeCoerce)(e),n),s.identity),unselect:(e,a)=>t(u.unselect((0,s.unsafeCoerce)(e),a),se.R.unselect((0,s.unsafeCoerce)(e),a),le.X.unselect(e),i.unselect((0,s.unsafeCoerce)(e),a),function(e,t){return i=>{const a=(0,n.pipe)(e,h.map((e=>t.compare(i,e)>0)),h.getOrElse(s.constTrue)),r=(0,n.pipe)(e,h.exists((e=>e.id===i.id)));return(0,n.pipe)(i,r?s.identity:Y(G.s.PositionState.invalidateHeight(i.positionState)),L.o.isHidden(i)?s.identity:z(L.o.VisualState.to(i.visualState,{type:"rendered",clockwise:a})))}}(e,a))}}function v(e,a,n,o,l,d){return{removeAlertFromItem:(c,u)=>t((t=>k.X.Capabilities.getRemoveAlerts(e,u.itemsOrd)(c,ce.In.getActiveItemOfType(i)(u))(t)),(e=>se.R.Capabilities.getRemoveAlertsCapability(o,l,d,u.itemsOrd)(c,ce.In.getActiveItemOfType(r)(u))(e)),s.identity,(e=>ne.G.getRemoveAlert(a,n,o).removeAlertFromItem(c,u)(e)),s.identity)}}function y(e,i,a,n){const r=k.X.Capabilities.getRemove(e);return{remove:(e,o)=>t(r.remove(e,o),(t=>e(t)?se.R.Capabilities.getRemove(a,n)([t.activeAlert],o(t))(t):t),s.identity,(t=>e(t)?i.removeAlerts(t.alerts,o(t))(t):t),s.identity)}}function C(e,i,a,n){const r=k.X.Capabilities.getUpdateWithAlert(e),o=se.R.Capabilities.getUpdatableWithAlertsCapability(i,n);return{updateWithAlerts:e=>t(r.updateWithAlerts(e),o(e),s.identity,a.updateWith(e),s.identity)}}e.equatable={structEq:u(k.X.eq,se.R.eq,le.X.eq,de.J.eq,M.g.eq),idEq:u(c,c,c,c,c),visualStateEq:u(m,m,m,m,m)},e.changePosition=p,e.disposable={isScheduledToDispose:t((e=>re.C.willBeDisposed(e,e.removedAlertsIds)),(e=>re.C.willBeDisposed(e,e.removedAlertsIds)),s.constFalse,(e=>re.C.willBeDisposed(e,e.removedAlertsIds)),s.constFalse)},e.hidable={isHidden:t(L.o.isHidden,L.o.isHidden,L.o.isHidden,L.o.isHidden,L.o.isHidden)},e.animatableItem=g,e.hasAlertsQueries={isSelectableByAlert:e=>t(re.C.hasAlert(e.alert.id),re.C.hasAlert(e.alert.id),s.constFalse,re.C.hasAlert(e.alert.id),s.constFalse),hasAlert:e=>t(re.C.hasAlert(e),re.C.hasAlert(e),s.constFalse,re.C.hasAlert(e),s.constFalse),hasActiveAlert:t((e=>h.some(e.activeAlert)),(e=>h.some(e.activeAlert)),(()=>h.none),(e=>h.some(e.activeAlert)),(()=>h.none))},e.changePositionStrategyQueries={useReferenceHeightOnRemove:t(s.constFalse,s.constFalse,s.constFalse,s.constTrue,s.constFalse)},e.select=S,e.removeAlert=v,e.remove=y,e.updateWithAlert=C,e.releaseAlert=(t,i,s,a,n,r)=>ue.v.Capabilities.getAlertReleaser({...v(t,i,s,a,n,r),...e.disposable}),e.unselectable=(e,t,i,s,a)=>ue.v.Capabilities.getUnselectable(ce.In.getActiveItem,S(e,t,i,s,a)),e.selectableByAlert=(t,i,s,a,n)=>ue.v.Capabilities.getSelectableByAlert(ce.In.getActiveItem,{...e.hasAlertsQueries,...S(t,i,s,a,n),...ue.v.Capabilities.getHasChecksFeed()}),e.selectableById=(e,t,i,s,a)=>ue.v.Capabilities.getSelectableById(ce.In.getActiveItem,S(e,t,i,s,a)),e.updateMeta=()=>({updateMeta:ue.v.Capabilities.getMetaUpdatable().updateMeta}),e.animatableFeed=(e,t,i,s,a,n)=>ue.v.Capabilities.getAnimatable(e,{...v(e,t,i,s,a,n),...g(e,t,n),...ue.v.Capabilities.getHasChecksFeed()}),e.hasPriorityToggle=(t,i,s)=>ue.v.WithPriority.getHasPriorityToggle({...g(t,i,s),...e.hasAlertsQueries,...e.disposable});const f=t=>["focused","expanded"].includes(t.visualState.transition.type)&&!e.disposable.isScheduledToDispose(t);function A(e,i){const s=ae.Mq.getCardSelections(i);return{nextAlert:t(s.nextAlert,s.nextAlert,(()=>h.none),e.nextAlert,(()=>h.none)),prevAlert:t(s.prevAlert,s.prevAlert,(()=>h.none),e.prevAlert,(()=>h.none))}}function b(){return{updateUserInput:e=>t(k.X.updateUserInput(e),se.R.changeUserInput(e),s.identity,s.identity,s.identity)}}e.alignable={isValidToAlign:t(f,f,s.constFalse,f,s.constFalse)},e.alertIterator=A,e.itemReleaser=(e,t,i)=>ne.G.getItemReleaser(e,t,i,ue.v.Capabilities.getItemReleaser()),e.hasAlerts=ue.v.Capabilities.getHasAlerts,e.getDefaultNextAlertItemFilter=t=>(0,me.W9)(e.isSelectableWithAlertItem,(i=>!e.disposable.isScheduledToDispose(i)&&(0,n.pipe)(i,e.hasAlertsQueries.hasActiveAlert,h.map((e=>t.isRegistered(e.id))),h.getOrElse(s.constFalse)))),e.hasUserInput=b,e.priorityTest=(0,me.W9)(i,(e=>ie.$.isPriority(e.activeAlert))),e.verifiable=()=>ue.v.Capabilities.getVerifiable(e.disposable),e.getCapabilities=function(t,i,a,n,r,o,l,c=(0,s.constant)(h.none),u=ae.IG.Default){return{...d(c,l),...e.disposable,...e.hidable,...e.equatable,...b(),...p(t,a),...g(t,a,r),...S(t,a,n,u,r),...y(t,a,u,r),...v(t,a,o,n,u,r),...C(t,i,a,r),...e.hasAlertsQueries,...e.changePositionStrategyQueries,...e.alignable,...e.releaseAlert(t,a,o,n,u,r),...e.unselectable(t,a,n,u,r),...e.selectableByAlert(t,a,n,u,r),...e.selectableById(t,a,n,u,r),...e.updateMeta(t),...e.animatableFeed(t,a,o,n,u,r),...e.hasPriorityToggle(t,a,r),...e.itemReleaser(a,o,n),...e.verifiable(),...e.hasAlerts(A(a,n),e.hasAlertsQueries,(()=>e.getDefaultNextAlertItemFilter(n)))}}}(K||(K={}))},65060:(e,t,i)=>{i.d(t,{g:()=>s,m:()=>m});var s,a=i(57050),n=i(2291),r=i(36156),o=i(16892),l=i(48521),d=i(4890),c=i(73975),u=i(5114);function m(e){return e.id===s.id}!function(e){e.id="ReadersAttentionItemId",e.kind="ReadersAttentionItem",e.eq=c.fromEquals(((e,t)=>e.hashCode()===t.hashCode()&&o.s.PositionState.eq.equals(e.positionState,t.positionState)&&l.o.VisualState.eq.equals(e.visualState,t.visualState))),e.hashCodeOwnFields=e=>(0,r.NO)({title:e.title,description:e.description,details:(0,a.pipe)(e.details,u.fold((()=>"none"),(e=>`some(${e})`))),attentionScore:n.T.prism.reverseGet(e.attentionScore)}),e.hashCode=e.hashCodeOwnFields,e.create=function(t,i,s){return{id:e.id,kind:e.kind,renderOptions:{...d.j.defaultOptions,layoutDensity:d.j.Density.minimal},positionState:i,visualState:s,title:t.title,description:t.description,details:t.details,attentionScore:t.attentionScore,equals(t){return e.eq.equals(this,t)},hashCode(){return e.hashCode(this)}}}}(s||(s={}))},16314:(e,t,i)=>{var s;function a(e){return e.type===s.miniCardClick}function n(e){return e.type===s.ignoreButtonClick}function r(e){return e.type===s.viewMoreButtonClick}function o(e){return e.type===s.feedbackButtonClick}i.d(t,{Dy:()=>s,Vl:()=>a,l9:()=>n,Q:()=>r,RJ:()=>o}),function(e){e.miniCardClick="readersAttentionItemMiniCardClick",e.ignoreButtonClick="readersAttentionItemIgnoreButtonClick",e.viewMoreButtonClick="readersAttentionItemViewMoreButtonClick",e.feedbackButtonClick="readersAttentionItemFeedbackButtonClick"}(s||(s={}))},35501:(e,t,i)=>{i.d(t,{h:()=>h,r:()=>g});var s=i(27378),a=i(63847),n=i(3656),r=i(77176),o=i(2291),l=i(8125),d=i(5739),c=i(12187),u=i(32821),m=i(35630);const p=({progress:e})=>s.createElement(d.F.Fragment,null,e.pipe(r.U((e=>s.createElement(a.P,{percentage:o.g.prism.reverseGet(e),colorType:a.P.ColorType.neoBlue,iconSize:a.P.IconSize.extraSmall,theme:{radialProgressBar:m.circleProgress,radialProgressText:m.circleText}}))))),h=e=>u.UI.Node.make((({view:t})=>s.createElement(d.F.div,{...(0,c.Sh)(m.header,t("density").pipe(r.U((e=>"normal"===e)),r.U((0,l.RN)(m.normal,m.compact))))},s.createElement("div",{className:m.progressIcon},s.createElement(p,{progress:t("attentionScore").pipe(r.U(o.g.fromRatio))})),s.createElement(n.XY,{...(0,c.Sh)(m.title,"full"===e?m.full:void 0)},t("title"))))),g=u.UI.Node.make((({view:e})=>s.createElement(s.Fragment,null,s.createElement("div",{className:m.progressContainer,"data-name":"attention-score-progress-bar"},s.createElement(d.F.div,{className:m.progressBar,style:{width:e("attentionScore").pipe(r.U(o.g.fromRatio),r.U(o.g.prism.reverseGet),r.U((e=>`${e}%`)))}},s.createElement(n.XY,{className:m.progressValue,"data-name":"attention-score-progress-value"},e("attentionScore").pipe(r.U(o.g.fromRatio),r.U(o.g.prism.reverseGet),r.U((e=>`${e}%`)))))),s.createElement(n.XY,{className:m.description},e("description")))))},56989:(e,t,i)=>{i.r(t),i.d(t,{ShortenItFeature:()=>$});var s,a=i(57050),n=i(74850),r=i(51972),o=i(5817),l=i(19751),d=i(85985),c=i(66310),u=i(80900),m=i(17343),p=i(93508),h=i(28043),g=i(76974),S=i(38983);!function(e){e.disconnected="disconnected",e.sessionStarted="sessionStarted",e.checking="checking",e.idle="idle"}(s||(s={}));class v{constructor(e,t){this._textObserver=e,this._requestAwaitService=t,this._logger=n.Y.create("ShortenItRequestManager"),this._sessionState=S.h.create({kind:s.sessionStarted}),this._typingDebounceDelay=(0,o.m9)(1),this._typingPaused=this._textObserver.contentChanges.async.pipe(d.h((e=>e.changes.length>0)),c.w((()=>u.H(this._typingDebounceDelay).pipe(m.h(!0),p.O(!1)))),p.O(!0),h.x(),l.d({bufferSize:1,refCount:!0}))}_flush(){this._logger.debug("flushing changes"),this._requestAwaitService.addRequest(Promise.resolve())}canSubmitRequest(){return this._typingPaused.pipe(c.w((e=>e?(this._flush(),u.H(500).pipe(c.w((()=>this._sessionState.view((e=>e.kind===s.idle)))))):g.of(!1))))}onNewRemoteRevision(e){e.sessionJustStarted&&this._onCAPISessionStarted(),this._sessionState.get().kind!==s.checking&&this._logger.trace("checking in progress"),this._sessionState.set({kind:s.checking,lastRevision:e.revision})}onRevisionFinished(e){const t=this._sessionState.get();t.kind===s.checking&&t.lastRevision===e&&(this._logger.trace("checking idle"),this._sessionState.set({kind:s.idle}))}onDisconnect(){this._logger.debug("websocket disconnected"),this._sessionState.set({kind:s.disconnected})}_onCAPISessionStarted(){this._logger.debug("session started"),this._sessionState.set({kind:s.sessionStarted})}}var y,C=i(17404),f=i(88097),A=i(14601),k=i(32952),b=i(77176),I=i(23063),w=i(24209),_=i(5114),R=i(71249);!function(e){e.isReceived=function(e){return e.kind===f.vQ.SummaryState.received},e.isNotFound=function(e){return e.kind===f.vQ.SummaryState.notFound}}(y||(y={}));class E{constructor(e,t){this._alertProcessor=e,this._textObserver=t,this._logger=n.Y.create("ShortenItRequestStateHolder"),this._subs=new A.w,this._summaryRequestState=new Map,this._summaryNotFound=new k.xQ,this._staleRequests=new Map,this._textChangedBeforeSummaryReceived=new k.xQ,this.summaryNotFound=this._summaryNotFound.asObservable(),this.textChangedBeforeSummaryReceived=this._textChangedBeforeSummaryReceived.asObservable(),this._trackSummaryReceived(),this._trackTextChanges()}_trackTextChanges(){this._subs.add(this._textObserver.contentChanges.async.subscribe((e=>{if(!e.deltaChange.isEmpty)for(const e of this._staleRequests.keys())this._staleRequests.set(e,!0)})))}onCAPISessionStarted(){this._summaryRequestState.clear(),this._staleRequests.clear()}onShortenItFinished(e){const t=this._summaryRequestState.get(e);if((null==t?void 0:t.kind)!==f.vQ.SummaryState.received){if(!0===this._staleRequests.get(e))return this._logger.info("request stale",e),void this._textChangedBeforeSummaryReceived.next(e);this._logger.info("summary not found",e),this._summaryRequestState.set(e,{kind:f.vQ.SummaryState.notFound,latency:(0,a.pipe)(_.fromNullable(this._summaryRequestState.get(e)),_.fold((()=>0),(e=>{switch(e.kind){case f.vQ.SummaryState.requestSent:return performance.now()-e.requestTimestamp;case f.vQ.SummaryState.notFound:return e.latency;default:return 0}})))}),this._summaryNotFound.next(e)}else this._staleRequests.delete(e)}onShortenItSubmit(e){this._staleRequests.set(e,!1),this._summaryRequestState.set(e,{kind:f.vQ.SummaryState.requestSent,requestTimestamp:performance.now()})}get(e){return _.fromNullable(this._summaryRequestState.get(e))}_trackSummaryReceived(){const e=this._alertProcessor.alerts.state.pipe(b.U((0,a.flow)(Object.values,Array.from,R.filter(C.S.isShortenItAlertWithSummary))),I.q(1)),t=this._alertProcessor.alerts.changes.pipe(b.U((e=>e.addedAlerts.concat(e.updatedAlerts).filter(C.S.isShortenItAlertWithSummary))));this._subs.add(w.T(e,t).subscribe((e=>{e.forEach((e=>{const t=e.id;this._logger.info("summary received",t),this._summaryRequestState.set(t,{kind:f.vQ.SummaryState.received,latency:(0,a.pipe)(_.fromNullable(this._summaryRequestState.get(t)),_.fold((()=>0),(e=>{switch(e.kind){case f.vQ.SummaryState.requestSent:return performance.now()-e.requestTimestamp;case f.vQ.SummaryState.received:return e.latency;default:return 0}})))})}))})))}dispose(){this._subs.unsubscribe()}}var q=i(36991),F=i(2291),T=i(15646),x=i(75316),U=i(35416),B=i(60797),N=i(16118),O=i(67434),P=i(85321),H=i(13444),Q=i(22232),M=i(83078),X=i(8125),D=i(73975),V=i(26328);function W(e){switch(e){case f.vQ.SummaryState.notRequested:case f.vQ.SummaryState.requested:case f.vQ.SummaryState.requestSent:case f.vQ.SummaryState.invalidated:return"longParagraphOrAILoadingCard";case f.vQ.SummaryState.received:return"summaryCard";case f.vQ.SummaryState.notFound:return"errorCard";default:(0,Q.vE)(e)}}class L{constructor(e,t,i){this._gnar=e,this._getSessionUuid=t,this._getRequestState=i}initAssistantTracking(e,t,i,s){const n=new A.w,o=new Map,c=new Map;return n.add(function(e,t){return e.pipe(d.h((0,X.Kg)(T.lY.isAlertIgnoreAction,T.lY.isAlertApplyAction,T.lY.isAlertResolveAction)),b.U((e=>(0,a.pipe)(t.getById(e.alertId),_.filter(f.bZ.isShortenIt),_.map((()=>e))))),B.oA)}(e,t).subscribe((e=>{switch(e.type){case T.lY.Type.alertIgnore:o.set(e.alertId,"dismissed");break;case T.lY.Type.alertApply:o.set(e.alertId,"accepted");break;case T.lY.Type.alertResolve:o.set(e.alertId,"resolved");break;default:(0,Q.vE)(e)}}))),n.add(function(e){return e.pipe(d.h((0,X.Kg)(T.ut.isCollapseAllEdits,T.ut.isExpandAllEdits,T.ut.isCollapseEdit,T.ut.isExpandEdit)))}(e).subscribe((e=>{var t,i;const s=c.get(e.alertId)||{};switch(e.type){case T.lY.Type.shortenItCollapseAllEdits:c.set(e.alertId,{...s,hideEditsClicked:!0});break;case T.lY.Type.shortenItExpandAllEdits:c.set(e.alertId,{...s,expandEditsClicked:!0});break;case T.lY.Type.shortenItCollapseEdit:c.set(e.alertId,{...s,numEllipsisHides:(null!==(t=s.numEllipsisHides)&&void 0!==t?t:0)+1});break;case T.lY.Type.shortenItExpandEdit:c.set(e.alertId,{...s,numEllipsisExpands:(null!==(i=s.numEllipsisExpands)&&void 0!==i?i:0)+1});break;default:(0,Q.vE)(e)}}))),n.add(function(e,t,i,s,n,o){return w.T(t.pipe(b.U(_.some)),i.pipe(m.h(_.none))).pipe(b.U(_.chain((t=>U.nL.hasItems(t)?(0,a.pipe)(r.O.getActiveItemWithAlert(t.currentLens),_.filter(x.C.isShortenItItem),_.map((e=>e.activeAlert)),_.chain((t=>(0,a.pipe)(e.getById(t.id),_.chain(f.bZ.getRawId),_.map((e=>({alert:t,rawAlertId:e}))))))):_.none))),l.$f(_.getEq(D.contramap((e=>({id:e.alert.id,activeView:W(e.alert.summaryState)})))(D.getStructEq({id:D.eqString,activeView:D.eqString})))),p.O(_.none),N.G(),O.R((({focusTimestamp:e},[t,i])=>{const r=(0,a.pipe)(t,_.map((e=>e.alert.id)),_.fold(a.constFalse,(e=>(0,a.pipe)(i,_.map((e=>e.alert.id)),M.contains(e))))),l=(0,a.pipe)(i,_.map((e=>e.alert.summaryState)),M.contains(f.vQ.SummaryState.received)),d=(0,a.pipe)(i,_.map((e=>e.alert.summaryState)),M.contains(f.vQ.SummaryState.notFound)),c=[];return(0,a.pipe)(t,M.tap((t=>{const i=t.alert.summaryState===f.vQ.SummaryState.received,s=t.alert.summaryState===f.vQ.SummaryState.notFound,u=_.toNullable(n(t.alert.id))||"unfocused";s?((0,Q.kG)("accepted"!==u,"Can't accept a ShortenIt alert that timed-out"),c.push({kind:"summaryNotFoundHide",reason:u,sentenceCount:t.alert.sentenceCount,wordCount:t.alert.wordCount})):i?((0,Q.kG)("resolved"!==u,"Can't resolve a ShortenIt alert with summary"),c.push({kind:"summaryAlertHide",alertId:t.alert.id,reason:u,sentenceCount:t.alert.sentenceCount,wordCount:t.alert.wordCount,compressionRatio:F.T.unwrap(t.alert.compressionRatio),numEllipsisExpands:0,numEllipsisHides:0,expandEditsClicked:!1,hideEditsClicked:!1,...o(t.alert.id),numEllipsisEdits:(0,a.pipe)(t.alert.getTransform(),_.chain((e=>_.fromEither(e.content))),_.map((e=>V.YM(e.alternatives))),_.fold((()=>0),(e=>e.delta.filter(q.s.isDelete).length)))})):t.alert.automaticSummaryRequest?((0,Q.kG)("accepted"!==u&&"dismissed"!==u&&"resolved"!==u,"Can't accept/dismiss/resolve a loading ShortenIt alert"),c.push({kind:"summaryAlertLoadingHide",reason:l&&r?"summaryReceived":d&&r?"timeoutReceived":u,duration:performance.now()-e,sentenceCount:t.alert.sentenceCount,wordCount:t.alert.wordCount})):((0,Q.kG)("accepted"!==u,"Can't accept a ShortenIt alert without summary"),c.push({kind:"longParagraphAlertHide",reason:l&&r?"summaryReceived":d&&r?"timeoutReceived":u,duration:performance.now()-e,sentenceCount:t.alert.sentenceCount,wordCount:t.alert.wordCount}))}))),(0,a.pipe)(i,M.tap((e=>{d?c.push({kind:"summaryNotFoundShow",reason:r?"timeoutReceived":"focused",sentenceCount:e.alert.sentenceCount,wordCount:e.alert.wordCount,latency:(0,a.pipe)(s(e.rawAlertId),_.getOrElse((()=>0)))}):l?c.push({kind:"summaryAlertShow",reason:r?"summaryReceived":"focused",sentenceCount:e.alert.sentenceCount,wordCount:e.alert.wordCount,compressionRatio:F.T.unwrap(e.alert.compressionRatio),latency:(0,a.pipe)(s(e.rawAlertId),_.getOrElse((()=>0)))}):e.alert.automaticSummaryRequest?c.push({kind:"summaryAlertLoadingShow",sentenceCount:e.alert.sentenceCount,wordCount:e.alert.wordCount}):c.push({kind:"longParagraphAlertShow",sentenceCount:e.alert.sentenceCount,wordCount:e.alert.wordCount})}))),{events:c,focusTimestamp:performance.now()}}),{events:[],focusTimestamp:performance.now()}),b.U((e=>e.events)),P.zg(a.identity))}(t,i.pipe(H.g(100)),s,(e=>(0,a.pipe)(this._getRequestState(e),_.filter((0,X.Kg)(y.isReceived,y.isNotFound)),_.map((e=>e.latency)))),(e=>_.fromNullable(o.get(e))),(e=>c.get(e)||{})).subscribe((e=>{!function(e,t,i){switch(t.kind){case"longParagraphAlertShow":e.shortenItLongParagraphShow(t.sentenceCount,t.wordCount,i);break;case"longParagraphAlertHide":e.shortenItLongParagraphHide(t.reason,t.sentenceCount,t.wordCount,t.duration,i);break;case"summaryAlertShow":e.shortenItSummaryShow(t.compressionRatio,t.latency,t.sentenceCount,t.wordCount,i,t.reason);break;case"summaryAlertHide":e.shortenItSummaryHide(t.compressionRatio,t.expandEditsClicked,t.hideEditsClicked,t.reason,t.sentenceCount,t.wordCount,t.numEllipsisEdits,t.numEllipsisExpands,t.numEllipsisHides,i);break;case"summaryAlertLoadingShow":e.shortenItSummaryLoadingShow(t.sentenceCount,t.wordCount,i);break;case"summaryAlertLoadingHide":e.shortenItSummaryLoadingHide(t.reason,t.sentenceCount,t.wordCount,t.duration,i);break;case"summaryNotFoundShow":e.shortenItSummaryNotFoundShow(t.latency,t.sentenceCount,t.wordCount,i,t.reason);break;case"summaryNotFoundHide":e.shortenItSummaryNotFoundHide(t.reason,t.sentenceCount,t.wordCount,i);break;default:(0,Q.vE)(t)}}(this._gnar,e,(0,a.pipe)(this._getSessionUuid(),_.getOrElse((()=>"")))),"summaryAlertHide"===e.kind&&c.delete(e.alertId)}))),n}}var G=i(84966),Y=i(79227),z=i(4390),K=i(44586),J=i(40151),Z=i(78674);class ${constructor(e,t,i,s,a){this._alertProcessor=e,this._textObserver=t,this._requestAwaitService=i,this._getSessionUuid=s,this._gnar=a,this._logger=n.Y.create("ShortenItFeature"),this._requestState=new E(this._alertProcessor,this._textObserver),this._requestManager=new v(this._textObserver,this._requestAwaitService),this._gnarTracking=new L(this._gnar,this._getSessionUuid,(e=>this._requestState.get(e)))}get addStateToRawAlertTransformer(){return e=>{if(G.wQ.isShortenIt(e)){const t=_.toNullable(this._requestState.get(e.id));return{...e,extra_properties:{...e.extra_properties,shorten_it_alert_state:{summaryState:null==t?void 0:t.kind}}}}return e}}onShortenItFinished(e){this._requestState.onShortenItFinished(e)}onNewRemoteRevision(e){e.sessionJustStarted&&this._requestState.onCAPISessionStarted(),this._requestManager.onNewRemoteRevision(e)}onRevisionFinished(e){this._requestManager.onRevisionFinished(e)}onDisconnect(){this._requestManager.onDisconnect()}initAssistantSession(e,t,i,s,n){return new K.y((()=>{const u=new A.w,p=new k.xQ;return u.add(w.T(function(e,t=(0,o.m9)(.5)){return e.pipe(b.U((e=>U.nL.hasItems(e)?(0,a.pipe)(r.O.getActiveItemWithAlert(e.currentLens),_.filter(x.C.isShortenItItem),_.filter((e=>e.activeAlert.automaticSummaryRequest&&(e.activeAlert.summaryState===f.vQ.SummaryState.notRequested||e.activeAlert.summaryState===f.vQ.SummaryState.invalidated))),_.map((e=>e.activeAlert.id))):_.none)),l.$f(_.getEq(D.eqString)),Z.b(t))}(i),e.pipe(d.h(T.ut.isRequestSummaryAction),b.U((e=>_.some(e.alertId)))),this._requestState.textChangedBeforeSummaryReceived.pipe(j(n))).pipe(c.w(_.fold((()=>J.E),(e=>this._requestManager.canSubmitRequest().pipe(d.h((e=>!0===e)),I.q(1),m.h(e)))))).subscribe((e=>{this._logger.info("submitting request for",e),s.sendShortenItSummaryRequest(e),(0,a.pipe)(t.getById(e),_.chain(f.bZ.getRawId),M.tap((e=>this._requestState.onShortenItSubmit(e))))}))),u.add(e.pipe(d.h(T.ut.isRequestSummaryAction)).subscribe((({alertId:e})=>{this._logger.info("received summary request for",e),s.changeShortenItSummaryState(e,"requested")}))),u.add(this._requestState.summaryNotFound.pipe(j(n),B.oA).subscribe((e=>s.changeShortenItSummaryState(e,"notFound")))),u.add(this._requestState.summaryNotFound.pipe(j(n),B.oA,H.g(1500)).subscribe((e=>s.applyFeedback(e,{kind:G.PZ.HIDE,subtype:Y.J.getSubTypeFromLens(i.get().currentLens.id)},f.l$.api)))),u.add(this._gnarTracking.initAssistantTracking(e,t,i,p)),()=>{p.next(),u.unsubscribe()}}))}dispose(){this._requestState.dispose()}}function j(e){return b.U((t=>(0,a.pipe)(e.get(),z.p.find((e=>(0,a.pipe)(f.bZ.getRawId(e.alert),M.contains(t)))),_.map((e=>e.alert.id)))))}},35630:e=>{e.exports={circleProgress:"_1npo5",circleText:"_3muDd",card:"AAT_T",header:"_3k6P5",compact:"_1Efs0",normal:"_2_T8O",progressIcon:"_3lupT",title:"_1U6tn",full:"_24i7N",progressContainer:"TH-Um",progressBar:"_1Tzvc",progressValue:"_1Ck8G",description:"_4m_YN"}},32585:e=>{e.exports={cardBody:"_1qMrW",description:"_3g_X-",actions:"G0xen",lessIcon:"_3HhMd",minimalDescription:"srN6O",actionsFooter:"_11uNl",feedbackFooter:"_2PAOt",viewMoreButton:"_1CGEL"}},11510:e=>{e.exports={miniCard:"_2FMyP"}}}]);